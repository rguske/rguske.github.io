<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>VMware Event Broker Appliance - vSphere HA Event Notification Function - Robert Guske</title><meta name="Description" content="rguske.github.io is a personal website which provides informational &amp; detailed content, based on Robert Guske¬¥s gained experiences with solutions by VMware (primarily)."><meta property="og:title" content="VMware Event Broker Appliance - vSphere HA Event Notification Function" />
<meta property="og:description" content="Community I recently had the pleasure to suppport a member out of the VMware Event Broker Appliance (VEBA) Slack Community with his function example contribution to the VEBA project. His name is Bob. He introduced his Powershell/ PowerCLI function on a remote session to me and I was immediately thrilled about what the function does. It covers a use case that one of my customers brought up some time ago when I first introduced VEBA to them." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rguske.github.io/post/vsphere-ha-event-notification-function/" />
<meta property="article:published_time" content="2020-06-29T15:19:05+02:00" />
<meta property="article:modified_time" content="2020-10-25T17:38:02+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="VMware Event Broker Appliance - vSphere HA Event Notification Function"/>
<meta name="twitter:description" content="Community I recently had the pleasure to suppport a member out of the VMware Event Broker Appliance (VEBA) Slack Community with his function example contribution to the VEBA project. His name is Bob. He introduced his Powershell/ PowerCLI function on a remote session to me and I was immediately thrilled about what the function does. It covers a use case that one of my customers brought up some time ago when I first introduced VEBA to them."/>
<meta name="application-name" content="Robert Guske">
<meta name="apple-mobile-web-app-title" content="Robert Guske"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://rguske.github.io/post/vsphere-ha-event-notification-function/" /><link rel="prev" href="https://rguske.github.io/post/monitoring-the-vmware-event-broker-appliance-with-vrealize-operations-manager/" /><link rel="next" href="https://rguske.github.io/post/vsphere-7-with-kubernetes-supercharged-helm-harbor-tkg/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><meta name="google-site-verification" content="WA7hqFngJR6BpdME_dqsDyCzWf8YVaWVM6FUUyycIoI" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "VMware Event Broker Appliance - vSphere HA Event Notification Function",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/rguske.github.io\/post\/vsphere-ha-event-notification-function\/"
        },"genre": "posts","keywords": "June2020, VEBA, FaaS","wordcount":  911 ,
        "url": "https:\/\/rguske.github.io\/post\/vsphere-ha-event-notification-function\/","datePublished": "2020-06-29T15:19:05+02:00","dateModified": "2020-10-25T17:38:02+01:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License. ¬© All rights reserved -2018","publisher": {
            "@type": "Organization",
            "name": "Robert Guske"},"author": {
                "@type": "Person",
                "name": "Robert Guske"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Robert Guske"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/avatar2.png"
        data-srcset="/img/avatar2.png, /img/avatar2.png 1.5x, /img/avatar2.png 2x"
        data-sizes="auto"
        alt="/img/avatar2.png"
        title="/img/avatar2.png" /><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="Take either the red pill or the blue pill"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/post/vmware-microsites-you-should-bookmark/" title="VMware Microsites"> VMware Microsites </a><a class="menu-item" href="/about/" title="The Author"> About </a><a class="menu-item" href="/disclaimer/"> Disclaimer </a><a class="menu-item" href="https://github.com/rguske" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Robert Guske"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/img/avatar2.png"
        data-srcset="/img/avatar2.png, /img/avatar2.png 1.5x, /img/avatar2.png 2x"
        data-sizes="auto"
        alt="/img/avatar2.png"
        title="/img/avatar2.png" /><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="Take either the red pill or the blue pill">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/post/vmware-microsites-you-should-bookmark/" title="VMware Microsites">VMware Microsites</a><a class="menu-item" href="/about/" title="The Author">About</a><a class="menu-item" href="/disclaimer/" title="">Disclaimer</a><a class="menu-item" href="https://github.com/rguske" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">VMware Event Broker Appliance - vSphere HA Event Notification Function</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/about/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Robert Guske</a></span>&nbsp;<span class="post-category">included in <a href="/categories/veba/"><i class="far fa-folder fa-fw"></i>VEBA</a>&nbsp;<a href="/categories/faas/"><i class="far fa-folder fa-fw"></i>FaaS</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-06-29">2020-06-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;911 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/harestartfunction_cover.jpg"
        data-srcset="/img/harestartfunction_cover.jpg, /img/harestartfunction_cover.jpg 1.5x, /img/harestartfunction_cover.jpg 2x"
        data-sizes="auto"
        alt="/img/harestartfunction_cover.jpg"
        title="/img/harestartfunction_cover.jpg" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#community">Community</a></li>
    <li><a href="#code">Code</a></li>
    <li><a href="#contribution">Contribution</a></li>
    <li><a href="#the-ha-restart-function">The HA Restart Function</a></li>
    <li><a href="#esxi-kernel-panic-command">ESXi Kernel Panic command</a></li>
    <li><a href="#you-have-mail">You have mail!</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="community">Community</h2>
<p>I recently had the pleasure to suppport a member out of the <a href="https://vmwarecode.slack.com/archives/CQLT9B5AA" target="_blank" rel="noopener noreffer">VMware Event Broker Appliance (VEBA) Slack Community</a> with his function example contribution to the <a href="https://vmweventbroker.io/" target="_blank" rel="noopener noreffer">VEBA</a> project. His name is Bob. He introduced his Powershell/ PowerCLI function on a remote session to me and I was immediately thrilled about what the function does. It covers a use case that one of my customers brought up some time ago when I first introduced VEBA to them.</p>
<p>Bob&rsquo;s engagement was really contagious and getting work done was quite fun. <strong>All credits goes out to Bob!</strong></p>
<h2 id="code">Code</h2>
<p>Bob developed a script some time ago, which functionality basically is, to send out a notification via Email after a vSphere HA event occurred. This Email will have the affected host mentioned as well as all affected VMs which has been restarted through vSphere HA. The problem was, that the execution of the script was a manual task every time a ESXi host outage took place&hellip;<strong>at least until he became aware of VEBA</strong>.</p>
<div class="details admonition quote open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-quote-right fa-fw"></i>Quote<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><em>&rdquo;&hellip;I knew VEBA would be a prime place to attempt to do this for me.&quot;</em></div>
        </div>
    </div>
<p>Then he started digging into it.</p>
<p>There is really good material available on <em>&ldquo;Getting started with VEBA&rdquo;</em> like for example this <a href="http://www.patrickkremer.com/veba/" target="_blank" rel="noopener noreffer">Series</a> by <a href="https://twitter.com/KremerPatrick" target="_blank" rel="noopener noreffer">Patrick Kremer</a> as well as articles and documentation on <em>&ldquo;Writing your own function&rdquo;</em> like e.g. <a href="https://medium.com/@pkblah/writing-your-first-serverless-function-23508cb4ea11" target="_blank" rel="noopener noreffer">Writing your first Serverless Function</a> by <a href="https://twitter.com/pkblah" target="_blank" rel="noopener noreffer">Partheeban Kandasamy (PK)</a> and also here at the <a href="https://vmweventbroker.io/kb/contribute-functions" target="_blank" rel="noopener noreffer">Documentation</a> section at VEBA&rsquo;s homepage.</p>
<p><strong>You don&rsquo;t have to reinvent the wheel!</strong> If you have great <code>code</code>, like Bob, take it, make your hands dirty and write your first function in any of your preferred programming language. It is not that complicated and I promise you the joy of success when your first function does exactly what you built it for.</p>
<p>If you don&rsquo;t have own code available, start looking here: <a href="https://code.vmware.com/samples?categories=Sample&amp;keywords=&amp;tags=PowerShell%7CVMware%20PowerCLI&amp;groups=&amp;filters=&amp;sort=dateDesc&amp;page=" target="_blank" rel="noopener noreffer">VMware {code} Sample Exchange</a>. The community is diligent and willing to share.</p>
<h2 id="contribution">Contribution</h2>
<p>You are probably wondering when I finally introduce the function, right? The reason for my long introduction in this post is that I want to encourage you to start building your own function(s) to unlock the potential of event-driven automation in your data center.</p>
<p>Like Bob successfully did. üòÅ</p>
<a class="lightgallery" href="/img/posts/202006_harestartfunction/CapturFiles-20200629_040718.jpg" title="/img/posts/202006_harestartfunction/CapturFiles-20200629_040718.jpg" data-thumbnail="/img/posts/202006_harestartfunction/CapturFiles-20200629_040718.jpg">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/posts/202006_harestartfunction/CapturFiles-20200629_040718.jpg"
            data-srcset="/img/posts/202006_harestartfunction/CapturFiles-20200629_040718.jpg, /img/posts/202006_harestartfunction/CapturFiles-20200629_040718.jpg 1.5x, /img/posts/202006_harestartfunction/CapturFiles-20200629_040718.jpg 2x"
            data-sizes="auto"
            alt="/img/posts/202006_harestartfunction/CapturFiles-20200629_040718.jpg" />
    </a>
<p>Here we go and waiting for it to get merged: <strong>VMware Event Broker Appliance</strong> <i class='fab fa-github fa-fw'></i> <strong>PR #183</strong> - <a href="https://github.com/vmware-samples/vcenter-event-broker-appliance/pull/183" target="_blank" rel="noopener noreffer">Add function HA Restarted VMs Email Notification</a></p>
<p>I had to share my excitment on Twitter when I first contributed to the project. It&rsquo;s a great and unique feeling and even better when the PR got merged.</p>
<center> <blockquote class="twitter-tweet" data-dnt="true"><p lang="en" dir="ltr">Another moment for my &quot;I&#39;ll never forget this box&quot;. 1st (last week) the feeling of having contributed to an <a href="https://twitter.com/hashtag/OpenSource?src=hash&amp;ref_src=twsrc%5Etfw">#OpenSource</a> project, my 1st PR (ever) was merged ü•≥and then on top of that, a ded. coding session with no one else than <a href="https://twitter.com/lamw?ref_src=twsrc%5Etfw">@lamw</a> today (PR#2 üò¨) üòÄ.  Thank you so much! <a href="https://twitter.com/hashtag/VEBA?src=hash&amp;ref_src=twsrc%5Etfw">#VEBA</a></p>&mdash; Robert Guske (@vmw_rguske) <a href="https://twitter.com/vmw_rguske/status/1216830346135842820?ref_src=twsrc%5Etfw">January 13, 2020</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
 </center>
<h2 id="the-ha-restart-function">The HA Restart Function</h2>
<p>I&rsquo;m not going into the details on how to deploy the function, because it works basically like the <a href="https://github.com/vmware-samples/vcenter-event-broker-appliance/tree/development/examples/powercli/datastore-usage-email" target="_blank" rel="noopener noreffer">vSphere Datastore Usage Email Notification</a> function which deployment is well explained step-by-step here: <a href="https://github.com/vmware-samples/vcenter-event-broker-appliance/tree/development/examples/powercli/datastore-usage-email" target="_blank" rel="noopener noreffer">vCenter Event Broker Appliance ‚Äì Part IX ‚Äì Deploying the Datastore Usage Email sample script in VMC</a>.</p>
<p>Exactly two files are important to deploy the function. The <code>vcconfig-ha-restarted-vms.json</code> and the <code>stack.yml.</code>
You have to fill out all the fields in the <code>vcconfig-ha-restarted-vms.json</code> file to have the required information like e.g. for the vCenter Server as well as for the SMTP server stored as a Kubernetes Secret.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;VC&#34;</span> <span class="p">:</span> <span class="s2">&#34;vcsa.jarvis.lab&#34;</span><span class="p">,</span>
    <span class="nt">&#34;VC_USERNAME&#34;</span> <span class="p">:</span> <span class="s2">&#34;vebauser@jarvis.lab&#34;</span><span class="p">,</span>
    <span class="nt">&#34;VC_PASSWORD&#34;</span> <span class="p">:</span> <span class="s2">&#34;VMware1!&#34;</span><span class="p">,</span>
    <span class="nt">&#34;SMTP_SERVER&#34;</span> <span class="p">:</span> <span class="s2">&#34;smtp.gmail.com&#34;</span><span class="p">,</span>
    <span class="nt">&#34;SMTP_PORT&#34;</span> <span class="p">:</span> <span class="s2">&#34;587&#34;</span><span class="p">,</span>
    <span class="nt">&#34;SMTP_USERNAME&#34;</span> <span class="p">:</span> <span class="s2">&#34;unknownidentity@gmail.com&#34;</span><span class="p">,</span>
    <span class="nt">&#34;SMTP_PASSWORD&#34;</span> <span class="p">:</span> <span class="s2">&#34;securepwd&#34;</span><span class="p">,</span>
    <span class="nt">&#34;EMAIL_TO&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;unknownidentity@gmail.com&#34;</span><span class="p">],</span>
    <span class="nt">&#34;EMAIL_FROM&#34;</span> <span class="p">:</span> <span class="s2">&#34;Jarvis Lab&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><em><center>vcconfig-ha-restarted-vms.json example</center></em></p>
<p>The below listed <code>stack.yml</code> file describes on which vCenter Event the function will be invoked, where the function image is stored and on which VEBA instance the function will finally run.</p>
<ul>
<li><code>topic: com.vmware.vc.HA.ClusterFailoverActionCompletedEvent</code></li>
<li><code>image: harbor.jarvis.lab/veba/veba-powercli-ha-restarted-vms:latest</code></li>
<li><code>gateway: https://veba041.jarvis.lab</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yml" data-lang="yml"><span class="k">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.0</span><span class="w">
</span><span class="w"></span><span class="k">provider</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>openfaas<span class="w">
</span><span class="w">  </span><span class="k">gateway</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//veba041.jarvis.lab<span class="w">
</span><span class="w"></span><span class="k">functions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">powercli-ha-restarted-vms</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">lang</span><span class="p">:</span><span class="w"> </span>powercli<span class="w">
</span><span class="w">    </span><span class="k">handler</span><span class="p">:</span><span class="w"> </span>./handler<span class="w">
</span><span class="w">    </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>harbor.jarvis.lab/veba/veba-powercli-ha-restarted-vms<span class="p">:</span>latest<span class="w">
</span><span class="w">    </span><span class="k">environment</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">write_debug</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="k">read_debug</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span><span class="k">function_debug</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">    </span><span class="k">secrets</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- vcconfig-ha-restarted-vms<span class="w">
</span><span class="w">    </span><span class="k">annotations</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">topic</span><span class="p">:</span><span class="w"> </span>com.vmware.vc.HA.ClusterFailoverActionCompletedEvent<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><em><center>stack.yml example</center></em></p>
<p>I have built the function from scratch and pushed it into my local container registry Harbor. If you would like to read more about <em>&ldquo;How to push your function images to Harbor&rdquo;</em>, take a look here: <a href="https://rguske.github.io/post/using-harbor-with-the-vcenter-event-broker-appliance/" target="_blank" rel="noopener noreffer">Using Harbor with the VMware Event Broker Appliance</a>.</p>
<p>After successfully deploying the function to my VEBA the next step is to simulate a host outage to trigger the aforementioned vCenter HA event.</p>
<h2 id="esxi-kernel-panic-command">ESXi Kernel Panic command</h2>
<p>I&rsquo;m using a <a href="https://www.virtuallyghetto.com/nested-virtualization" target="_blank" rel="noopener noreffer">nested vSphere Cluster</a> in my Homelab to simulate the outage. Connect to your nested ESXi host via <code>ssh</code> and execute the following command to perform a ESXi Kernel Panic. Please use this command with caution!</p>
<div class="details admonition danger open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-skull-crossbones fa-fw"></i>Danger<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">vsish -e set /reliability/crashMe/Panic 1</div>
        </div>
    </div>
<p>And here it goes! The below screenshot from the H5 vSphere client shows the affected host (top left: nesxi67-02.jarvis.lab) as well as the occurred vCenter event which triggers our function.</p>
<a class="lightgallery" href="/img/posts/202006_harestartfunction/CapturFiles-20200701_023157.jpg" title="/img/posts/202006_harestartfunction/CapturFiles-20200701_023157.jpg" data-thumbnail="/img/posts/202006_harestartfunction/CapturFiles-20200701_023157.jpg">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/posts/202006_harestartfunction/CapturFiles-20200701_023157.jpg"
            data-srcset="/img/posts/202006_harestartfunction/CapturFiles-20200701_023157.jpg, /img/posts/202006_harestartfunction/CapturFiles-20200701_023157.jpg 1.5x, /img/posts/202006_harestartfunction/CapturFiles-20200701_023157.jpg 2x"
            data-sizes="auto"
            alt="/img/posts/202006_harestartfunction/CapturFiles-20200701_023157.jpg" />
    </a>
<p>A more detailed view can be done via a terminal. Below you can see the deployed <em>ha-restarted-vms</em> function running as a Kubernetes POD on VEBA (lower left), the ESXi Kernel Panic command (lower right) and the invocation of the <em>HA Restart Function</em> triggered by the occurred vCenter HA event (top right).</p>
<a class="lightgallery" href="/img/posts/202006_harestartfunction/CapturFiles-20200629_102941.jpg" title="/img/posts/202006_harestartfunction/CapturFiles-20200629_102941.jpg" data-thumbnail="/img/posts/202006_harestartfunction/CapturFiles-20200629_102941.jpg">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/posts/202006_harestartfunction/CapturFiles-20200629_102941.jpg"
            data-srcset="/img/posts/202006_harestartfunction/CapturFiles-20200629_102941.jpg, /img/posts/202006_harestartfunction/CapturFiles-20200629_102941.jpg 1.5x, /img/posts/202006_harestartfunction/CapturFiles-20200629_102941.jpg 2x"
            data-sizes="auto"
            alt="/img/posts/202006_harestartfunction/CapturFiles-20200629_102941.jpg" />
    </a>
<h2 id="you-have-mail">You have mail!</h2>
<p>If everything operates as expected, you should have received an email according to the following screenshot of the one I received.</p>
<a class="lightgallery" href="/img/posts/202006_harestartfunction/CapturFiles-20200701_022720.jpg" title="/img/posts/202006_harestartfunction/CapturFiles-20200701_022720.jpg" data-thumbnail="/img/posts/202006_harestartfunction/CapturFiles-20200701_022720.jpg">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/img/posts/202006_harestartfunction/CapturFiles-20200701_022720.jpg"
            data-srcset="/img/posts/202006_harestartfunction/CapturFiles-20200701_022720.jpg, /img/posts/202006_harestartfunction/CapturFiles-20200701_022720.jpg 1.5x, /img/posts/202006_harestartfunction/CapturFiles-20200701_022720.jpg 2x"
            data-sizes="auto"
            alt="/img/posts/202006_harestartfunction/CapturFiles-20200701_022720.jpg" />
    </a>
<p><strong>Thanks Bob! Keep up the great work.</strong></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2020-10-25&nbsp;<a class="git-hash" href="https://github.com/rguske/commit/5e0ac3a949d4f994bd5f8acad06a0b3fce02277f" target="_blank" title="commit by Robert Guske(rguske@vmware.com) 5e0ac3a949d4f994bd5f8acad06a0b3fce02277f: markdown cleanup on all posts">
                                    <i class="fas fa-hashtag fa-fw"></i>5e0ac3a</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/post/vsphere-ha-event-notification-function/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/" data-title="VMware Event Broker Appliance - vSphere HA Event Notification Function" data-via="vmw_rguske" data-hashtags="June2020,VEBA,FaaS"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/" data-title="VMware Event Broker Appliance - vSphere HA Event Notification Function" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Share on Xing" data-sharer="xing" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/" data-title="VMware Event Broker Appliance - vSphere HA Event Notification Function"><i class="fab fa-xing fa-fw"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/" data-title="VMware Event Broker Appliance - vSphere HA Event Notification Function" data-description=""><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/" data-title="VMware Event Broker Appliance - vSphere HA Event Notification Function"><i class="fab fa-evernote fa-fw"></i></a><a href="javascript:void(0);" title="Share on Skype" data-sharer="skype" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/" data-title="VMware Event Broker Appliance - vSphere HA Event Notification Function"><i class="fab fa-skype fa-fw"></i></a><a href="javascript:void(0);" title="Share on Trello" data-sharer="trello" data-url="https://rguske.github.io/post/vsphere-ha-event-notification-function/" data-title="VMware Event Broker Appliance - vSphere HA Event Notification Function" data-description=""><i class="fab fa-trello fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/june2020/">June2020</a>,&nbsp;<a href="/tags/veba/">VEBA</a>,&nbsp;<a href="/tags/faas/">FaaS</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/post/monitoring-the-vmware-event-broker-appliance-with-vrealize-operations-manager/" class="prev" rel="prev" title="Monitoring the VMware Event Broker Appliance with vRealize Operations Manager"><i class="fas fa-angle-left fa-fw"></i>Monitoring the VMware Event Broker Appliance with vRealize Operations Manager</a>
            <a href="/post/vsphere-7-with-kubernetes-supercharged-helm-harbor-tkg/" class="next" rel="next" title="vSphere 7 with Kubernetes supercharged - Helm, Harbor and Tanzu Kubernetes Grid">vSphere 7 with Kubernetes supercharged - Helm, Harbor and Tanzu Kubernetes Grid<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2018 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/about/" target="_blank">Robert Guske</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@7.0.4/dist/typeit.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":80},"comment":{"gitalk":{"admin":["rguske"],"clientID":"dac5316ea2f4d94cc34a","clientSecret":"295c1cbf7f708263cbe7e63de8856790bc549f37","id":"2020-06-29T15:19:05+02:00","owner":"rguske","repo":"my-gitalk","title":"VMware Event Broker Appliance - vSphere HA Event Notification Function"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"   rguske.github.io","id-2":"   rguske.github.io"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":0,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'UA-122353302-1', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-122353302-1" async></script></body>
</html>
