<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Upgrade vSphere Integrated Containers &middot; </title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://rguske.github.io/favicon.ico" />
    <link rel="canonical" href="https://rguske.github.io/post/upgrade-vsphere-integrated-containers/" />

     <meta name="description" content="I like upgrades! Because mostly they bring cool new features with them or eliminate disturbing issues. In this post I´d like to guide you through the upgrade pr" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://rguske.github.io/img/vic_upgrade_post_cover.jpg"/>
    
 
    <meta name="twitter:title" content="Upgrade vSphere Integrated Containers"/>
    <meta name="twitter:description" content="I like upgrades! Because mostly they bring cool new features with them or eliminate disturbing issues. In this post I´d like to guide you through the upgrade pr"/>
    <meta name="twitter:url" content="https://rguske.github.io/post/upgrade-vsphere-integrated-containers/" />
    <meta name="twitter:site" content="@vmw_rguske"/>

    <meta property="og:site_name" content="" />
    <meta property="og:title" content="Upgrade vSphere Integrated Containers &middot; j.a.r.v.i.s." />
    <meta property="og:url" content="https://rguske.github.io/post/upgrade-vsphere-integrated-containers/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="I like upgrades! Because mostly they bring cool new features with them or eliminate disturbing issues. In this post I´d like to guide you through the upgrade pr" />

    <meta property="article:published_time" content="2018-10-19T00:11:11&#43;02:00" />
    <meta property="article:tag" content="VIC" /><meta property="article:tag" content="Container" /><meta property="article:tag" content="VMware" /><meta property="article:tag" content="vSphere" /><meta property="article:tag" content="Docker" /><meta property="article:tag" content="Upgrade" />

    <meta property="og:image" content="https://rguske.github.io/img/vic_upgrade_post_cover.jpg"/>


    <meta name="generator" content="Hugo 0.53" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://rguske.github.io/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="https://rguske.github.io/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    

     

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
    <script>
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#343c66",
          "text": "#cfcfe8"
        },
        "button": {
          "background": "#f71559"
        }
      }
    })});
    </script>

</head>


<body class="ctsingle">

  <div class="site-wrapper"> 

<header class="site-header outer "  style="background-image: url(https://rguske.github.io/img/blog-cover.jpg)"  >
  <div class="inner">
    <div class="site-header-content">
      <h1 class="site-title"> j.a.r.v.i.s.  </h1>
        <h2 class="site-description">Sometimes you gotta run before you can walk! </h2>
    </div>

    <nav class="site-nav">
      <div class="site-nav-left"><ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="https://rguske.github.io/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://rguske.github.io/about">About Me</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://rguske.github.io/disclaimer">Disclaimer</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://rguske.github.io/tags">Tags</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://github.com/rguske/vic-machine">vic-machine utility examples</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://blogs.vmware.com/cloudnative/">VMware´s Offical CNA Blog</a>
            </li>
        
            <li class="nav-current" role="menuitem">
              <a href="https://rguske.github.io/post/">Posts</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/vmw_rguske" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/rguske" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    <a class="social-link" href="https://www.linkedin.com/in/robert-guske-830853111" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 50 512 512"><path d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683 C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615 c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915 s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z" /></svg></a>

                    
        </div>  
            
      </div>

    </nav>  

  </div>
</header>


<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
    <div class="post-feed">
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://rguske.github.io/post/upgrade-vsphere-integrated-containers/">
      <div class="post-card-image" style="background-image: url(https://rguske.github.io/img/vic_upgrade_post_cover.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://rguske.github.io/post/upgrade-vsphere-integrated-containers/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #VIC 
              #Container 
              #VMware 
              #vSphere 
              #Docker 
              #Upgrade  </span>
              
              <h2 class="post-card-title">Upgrade vSphere Integrated Containers</h2>
          </header>
      </a>
      <section class="post-card-excerpt" style="padding: 0 25px;">
          

<p>I like upgrades! Because mostly they bring cool new features with them or eliminate disturbing issues.
In this post I´d like to guide you through the upgrade process of <a href="https://rguske.github.io/post/vmware-vsphere-integrated-containers-introduction">VMware vSphere Integrated Containers </a> from version v1.3.1 to v1.4.1 which is a major upgrade and also to v1.4.3 which is a minor upgrade.</p>

<p>Thanks <a href="https://twitter.com/tom_schwaller" target="_blank">Tom Schwaller</a> for reviewing this article.</p>

<p>First of all and this applies to all upgrades, we have to check the compatibility and dependencys with our infrastructure components. This is for instance our vCenter Server where we have dependencies through the <a href="https://rguske.github.io/post/vsphere-integrated-containers-part-ii-vsphere-client-plug-in">VIC vSphere Client Plug-In</a>!</p>

<p>VIC version 1.4.0 is e.g. compatible with vCenter Server version 6.0.0 U2 until 6.7.0! VIC verison 1.3.0 in contrast to leaves version 6.0.0 U2 as well as 6.5.0. See <a href="https://www.vmware.com/resources/compatibility/sim/interop_matrix.php#interop&2=&149=" target="_blank">VMware Product Interoperability Matrices</a>.</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181017_081612.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181017_081612.jpg" width="800"></img></a></center></p>

<p>Of course the same applies to the upgrade path of the solution itself. You can check the <a href="https://www.vmware.com/resources/compatibility/sim/interop_matrix.php#upgrade" target="_blank"> Upgrade Path </a> for every specific VMware solution also over the VMware Product Interoperability Matrices. You´ll find the available upgrade paths for VIC <a href="https://www.vmware.com/resources/compatibility/sim/interop_matrix.php#upgrade&solution=149" target="_blank"> HERE </a>.</p>

<p>Let´s now take a look at the interoperability for vSphere Integrated Containers:</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20180815_084838.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20180815_084838.jpg" width="850"></img></a></center></p>

<p>We can see that an upgrade from version 1.3.1 to 1.4(.x) is supported and this is for us the final sign to start.</p>

<p>The upgrade itself can be splitted into four phases.</p>

<ol>
<li>VIC Appliance rollout in the desired and supported version</li>
<li>Download of the newest VIC Engine Bundle (<code>vic-machine</code>)</li>
<li>VIC vSphere Client Plug-In upgrade</li>
<li>Upgrade of the Virtual Container Host(s)</li>
</ol>

<p>Before we initiate the deployment of the new VIC Appliance, we´ll validate our used versions. For the VIC Appliance itself we´ll simply start the VMware Remote Console which will then show us the currently used version.</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20180807_115237.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20180807_115237.jpg" width="850"></img></a></center></p>

<p><strong>Version</strong> (Github versioning): <strong>1.3.1</strong> (<a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging" target="_blank">Tag</a>) <strong>3409</strong> (Build) <strong>132fb13</strong> (<a href="https://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository" target="_blank">last Commit</a>)</p>

<p>Next, we´ll check the version of our running Virtual Container Host(s) by using the command <code>docker info</code>.</p>

<p>As described in my previous post <a href="https://rguske.github.io/post/vsphere-integrated-containers-part-iv-docker-run-a-container-vm/"> vSphere Integrated Containers Part IV: docker run a Container-VM </a> we can export our VCH through it´s IP-Address and port via <code>export DOCKER_HOST=192.168.100.220:2376</code>.</p>

<p>After we´ve exported it we´ll fire up <code>docker --tls info</code> what will show us the following output:</p>

<pre><code class="language-bash">Containers: 7
 Running: 7
 Paused: 0
 Stopped: 0
Images: 5
Server Version: v1.3.1-16055-afdab46
Storage Driver: vSphere Integrated Containers v1.3.1-16055-afdab46 Backend Engine
VolumeStores: default
vSphere Integrated Containers v1.3.1-16055-afdab46 Backend Engine: RUNNING
 VCH CPU limit: 22800 MHz
 VCH memory limit: 30.49 GiB
 VCH CPU usage: 79 MHz
 VCH memory usage: 1.637 GiB
 VMware Product: VMware vCenter Server
 VMware OS: linux-x64
 VMware OS version: 6.7.0
 Registry Whitelist Mode: disabled.  All registry access allowed.
Plugins:
 Volume: vsphere
 Network: bridge container-net
 Log:
Swarm: inactive
Operating System: linux-x64
OSType: linux-x64
Architecture: x86_64
CPUs: 22800
Total Memory: 30.49GiB
ID: vSphere Integrated Containers
Docker Root Dir:
Debug Mode (client): false
Debug Mode (server): false
Registry: registry.hub.docker.com
Experimental: false
Live Restore Enabled: false
</code></pre>

<p>The server version which is running within our VCH is v1.3.1-16055-afdab46.</p>

<p>Another way to get the desired info is to make use of the <code>vic-machine</code> command line utility with the option <code>inspect</code>:</p>

<pre><code class="language-bash">./vic-machine-darwin inspect \
--target lab-vcsa67-001.lab.jarvis.local/Datacenter-South \
--user adm.jarvis@LAB.JARVIS.LOCAL \
--thumbprint 4F:D3:9B:50:00:31:D9:84:9D:DA:CF:57:21:D6:0D:11:89:78:97:26 \
--name vch-elk
</code></pre>

<p>The output will also show us the VCH version and the Installer version from which the VCH got deployed as well&hellip;</p>

<pre><code class="language-bash">INFO[0000] vSphere password for adm.jarvis@LAB.JARVIS.LOCAL:
INFO[0004] ### Inspecting VCH ####
INFO[0005] Validating target
INFO[0005]
INFO[0005] VCH ID: VirtualMachine:vm-1190
INFO[0005]
INFO[0005] Installer version: v1.3.1-16055-afdab46
INFO[0005] VCH version: v1.3.1-16055-afdab46
INFO[0005]
INFO[0005] VCH upgrade status:
INFO[0005] Installer has same version as VCH
INFO[0005] No upgrade available with this installer version
WARN[0005] Unable to identify address acceptable to host certificate
INFO[0005]
INFO[0005] VCH Admin Portal:
INFO[0005] https://192.168.100.220:2378
INFO[0005]
INFO[0005] Published ports can be reached at:
INFO[0005] 192.168.100.220
INFO[0005]
INFO[0005] Docker environment variables:
INFO[0005] DOCKER_HOST=192.168.100.220:2376
INFO[0005]
INFO[0005] Connect to docker:
INFO[0005] docker -H 192.168.100.220:2376 --tls info
INFO[0005] Completed successfully
</code></pre>

<p>&hellip;and a hint regarding the <em>VCH Upgrade Status</em>:</p>

<blockquote>
<p>INFO[0005] VCH upgrade status:</p>

<p>INFO[0005] Installer has same version as VCH</p>

<p>INFO[0005] No upgrade available with this installer version</p>
</blockquote>

<p>If we run <code>vic-machine inspect</code> executed from a newer VIC-Bundle like 1.4.x for example we´ll see that the installer version differs from the VCH version. But more about this later on.</p>

<hr />

<p><strong>By the way!</strong> I´ve documented a few examples of <code>vic-machine</code> options on my Github-Repo <a href="https://github.com/rguske/vic-machine">https://github.com/rguske/vic-machine</a></p>

<hr />

<h2 id="phase-i">Phase I</h2>

<p><strong>VIC Appliance Upgrade v1.3.1 to 1.4.1</strong></p>

<p>I suppose that you are familiar with the VIC Appliance deployment because this post described the upgrade of an already deployed VIC appliance but in case not, you can go <a href="https://rguske.github.io/post/vsphere-integrated-containers-part-i-ova-deployment" target="_blank"> here</a> first.</p>

<p><strong>Download</strong> the latest bits through this link: <a href="https://www.vmware.com/go/download-vic" target="_blank">www.vmware.com/go/download-vic</a>.</p>

<p>Start the deployment and be aware of the fact, that <em>this is NOT an Inplace-Upgrade</em> and therefore we have to enter a new IP address as well as FQDN.</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20180918_082532.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20180918_082532.jpg" width="800"></img></a></center></p>

<p>If you wish to reuse the originally IP address after the upgrade, reconfigure the old appliance to use a temporary IP address before you start the upgrade.</p>

<p>VIC Appliance &ndash;&gt; Edit Settings &ndash;&gt; vApp Options</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181016_112747.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181016_112747.jpg" width="800"></img></a></center></p>

<p>At this point I´d like to quote the following astracts from the <a href="https://vmware.github.io/vic-product/assets/files/html/1.4/vic_vsphere_admin/upgrade_appliance.html" target="_blank"> Upgrade section </a>of the official documentation page:</p>

<blockquote>
<p><strong>The upgrade process copies data from the old appliance to the new appliance</strong>. Consequently, if you deployed the appliances to a cluster, the virtual disks for the two appliances must be located in the same datastore cluster.</p>
</blockquote>

<p>and</p>

<blockquote>
<p><strong>IMPORTANT:</strong> <strong>After the new appliance has initialized, do not go to the Getting Started page of the appliance</strong>. Logging in to the Getting Started page for the first time initializes the appliance. Initialization is only applicable to new installations and causes upgraded appliances not to function correctly.</p>
</blockquote>

<p><strong>Another important point</strong> to mention is that you cannot upgrade between untagged, open source builds of the same release like 1.4.3 open source build to 1.4.3 official build for example.</p>

<p>After the deployment of the new VIC Appliance we´ll establish a <code>ssh</code> connection to it.</p>

<pre><code class="language-bash">ssh root@192.168.100.161
</code></pre>

<pre><code class="language-shell">The authenticity of host '192.168.100.161 (192.168.100.161)' can't be established.
ECDSA key fingerprint is SHA256:iVIdb5Sv1pxUsiqelop7DVubJcvjuHHbPSJWBg3No1g.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.100.161' (ECDSA) to the list of known hosts.

##########################################################################
##  SSH access to the vSphere Integrated Containers Appliance can be    ##
##  used in exceptional cases that cannot be handled through standard   ##
##  remote management or CLI tools. This is primarily intended for use  ##
##  in break-fix scenarios, under the guidance of VMware GSS.           ##
##########################################################################

Password:

##########################################################################
##  SSH access to the vSphere Integrated Containers Appliance can be    ##
##  used in exceptional cases that cannot be handled through standard   ##
##  remote management or CLI tools. This is primarily intended for use  ##
##  in break-fix scenarios, under the guidance of VMware GSS.           ##
##########################################################################
</code></pre>

<p>Use <code>cd /etc/vmware/upgrade</code> to go into the directory which contains the <code>./upgrade.sh</code> script and execute it. You´ll be promped to enter the neccassary information. As an alternative you can also specify the neccassary arguments upfront like this:</p>

<pre><code class="language-shell">./upgrade.sh --target 192.168.178.72 \        ### vCenter Server
--username 'administrator@jarvis.local' \     ### User with appropriate permissions
--password '*********'   \                    ### Password
--fingerprint '192.168.178.72 4F:D3:9B...' \  ### vCenter Server Fingerprint
--dc Datacenter-North \                       ### vSphere Datacenter
--embedded-psc \                              ### Platform Service Controller (--embedded-psc or --external-psc)
--appliance-target 192.168.100.160 \          ### VIC Appliance where we´d upgrade from
--appliance-username root \                   ### VIC Appliance root user
--appliance-password VMware1234!?! \          ### root user password
--appliance-version v1.3.1 \                  ### VIC Appliance version where we come from
--destroy                                     ### Destroy the the old appliance after the upgrade is finished.
</code></pre>

<p>See: <a href="https://vmware.github.io/vic-product/assets/files/html/1.4/vic_vsphere_admin/upgrade_appliance.html#upgradeoptions" target="_blank"> Specify Command Line Options During Appliance Upgrade </a></p>

<p>The first time I ran the upgrade it ended up in an error which was related to the &ldquo;<strong>? letter</strong>&rdquo; which I´ve used in my password.</p>

<pre><code class="language-shell">root@vic02 [ /etc/vmware/upgrade ]# ./upgrade.sh
-------------------------------
VIC Appliance Upgrade to v1.4.1
-------------------------------

[=] Values containing $ (dollar sign), ` (backquote), \' (single quote), &quot; (double quote), and \ (backslash) will not be substituted properly.
[=] Change any input (passwords) containing these values before running this script.
Enter vCenter Server FQDN or IP: lab-vcsa67-001.lab.jarvis.local
Enter vCenter Administrator Username: administrator@jarvis.local
Enter vCenter Administrator Password:
If using an external PSC, enter the FQDN of the PSC instance (leave blank otherwise):
If using an external PSC, enter the PSC Admin Domain (leave blank otherwise):
govc: dial tcp: address tcp/VMware1234!: unknown port
[=]
[=] -------------------------
[=] Upgrade failed.
[=] Please save /var/log/vmware/upgrade.log and contact VMware support.
[=] -------------------------
[=]
</code></pre>

<p>The output <code>govc: dial tcp: address tcp/VMware1234!: unknown port</code> gives us first indications that it might be closely connected with the letters in my password. There are two ways to bypass this.</p>

<ol>
<li><strong>[The easy way]</strong> Use another user with the needed permissions (see <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.security.doc/GUID-21EF0E93-0003-4D41-AA11-A73824E1A88C.html" target="_blank"> <em>vSphere Extension Privileges</em>)</a> and without including an <strong>?</strong> in the password.</li>
<li><strong>[The <a href="https://github.com/vmware/govmomi" target="_blank"> govmomi </a> way]</strong> Use the workaround described here: <a href="https://github.com/vmware/govmomi/issues/1203" target="_blank"> github.com/vmware/govmomi/issues/1203 </a></li>
</ol>

<p>I´ve chosen the easy way ;-) and this is how it looks when the upgrade to <strong>v1.4.1</strong> went well:</p>

<pre><code class="language-shell">root@vic02 [ /etc/vmware/upgrade ]# ./upgrade.sh
-------------------------------
VIC Appliance Upgrade to v1.4.1
-------------------------------

2018-08-16 21:20:30 [=] Values containing $ (dollar sign), ` (backquote), \' (single quote), &quot; (double quote), and \ (backslash) will not besubstituted properly.
2018-08-16 21:20:30 [=] Change any input (passwords) containing these values before running this script.
Enter vCenter Server FQDN or IP: 192.168.178.72
Enter vCenter Administrator Username: admin@jarvis.local
Enter vCenter Administrator Password:
If using an external PSC, enter the FQDN of the PSC instance (leave blank otherwise):
If using an external PSC, enter the PSC Admin Domain (leave blank otherwise):

Please verify the vCenter IP and TLS fingerprint: 192.168.178.72 4F:D3:9B:50:00:31:D9:84:9D:DA:CF:57:21:D6:0D:11:89:78:97:26
Is the fingerprint correct? (y/n): y
Enter vCenter Datacenter of the old VIC appliance: Datacenter-North
Enter old VIC appliance IP: 192.168.100.160
Enter old VIC appliance username: root
2018-08-16 21:21:25 [=]
-------------------------
Starting upgrade 2018-08-16 21:20:30 +0000 UTC

2018-08-16 21:21:26 [=] Please enter the VIC appliance password for root@192.168.100.160
Password:
2018-08-16 21:21:36 [=]
2018-08-16 21:21:36 [=] Detected old appliance's version as v1.3.1.
2018-08-16 21:21:36 [=] If the old appliance's version is not detected correctly, please enter &quot;n&quot; to abort the upgrade and contact VMware support.
2018-08-16 21:21:36 [=]
2018-08-16 21:21:36 [=] Do you wish to proceed with upgrade? [y/n]
y
2018-08-16 21:21:43 [=] Continuing with upgrade
2018-08-16 21:21:43 [=]
2018-08-16 21:21:45 [=] Waiting for old VIC appliance to power off
2018-08-16 21:22:00 [=] Waiting for old VIC appliance to power off
2018-08-16 21:22:18 [=] Migrating old disks to new VIC appliance...
2018-08-16 21:22:19 [=] Copying old data disk. Please wait.
2018-08-16 21:22:25 [=] Copying old database disk. Please wait.
2018-08-16 21:22:32 [=] Copying old log disk. Please wait.
2018-08-16 21:22:41 [=] Finished attaching migrated disks to new VIC appliance
2018-08-16 21:22:41 [=] Preparing upgrade environment
2018-08-16 21:22:41 [=] Disabling and stopping Admiral and Harbor
2018-08-16 21:22:41 [=] Waiting for register appliance...
2018-08-16 21:22:51 [=] Waiting for register appliance...
2018-08-16 21:23:01 [=] Waiting for register appliance...
2018-08-16 21:23:40 [=] Finished preparing upgrade environment
2018-08-16 21:23:40 [=]
-------------------------
Starting Admiral Upgrade 2018-08-16 21:20:30 +0000 UTC

2018-08-16 21:23:40 [=] Performing pre-upgrade checks
2018-08-16 21:23:40 [=] Starting Admiral upgrade
2018-08-16 21:24:28 [=] Updating Admiral configuration
2018-08-16 21:24:28 [=] Restarting Admiral
2018-08-16 21:25:17 [=]
-------------------------
Starting Harbor Upgrade 2018-08-16 21:20:30 +0000 UTC

2018-08-16 21:25:17 [=] Performing pre-upgrade checks
2018-08-16 21:25:17 [=] Starting Harbor upgrade
2018-08-16 21:25:17 [=] [=] Shutting down Harbor
2018-08-16 21:25:17 [=] [=] Migrating Harbor configuration and data
2018-08-16 21:25:17 [=] Testing database credentials...
2018-08-16 21:25:18 [=] Backing up harbor config...
2018-08-16 21:25:23 [=] [=] Successfully migrated Harbor configuration and data
2018-08-16 21:25:23 [=] Harbor upgrade complete
2018-08-16 21:25:23 [=] Starting Harbor
2018-08-16 21:25:33 [=] Enabling and starting Admiral and Harbor
2018-08-16 21:25:33 [=]
2018-08-16 21:25:33 [=] -------------------------
2018-08-16 21:25:33 [=] Upgrade completed successfully. Exiting.
2018-08-16 21:25:33 [=] -------------------------
</code></pre>

<p>All neccessary information about the upgrade are also available in the <strong>upgrade.log</strong> which is deposited under <code>/var/log/vmware</code> on the VIC appliance.</p>

<hr />

<h2 id="phase-ii">Phase II</h2>

<p><strong>Download of the newest VIC Engine Bundle (<code>vic-machine</code>)</strong></p>

<p>In phase two we´ll download the VIC Engine Bundle which includes the following:</p>

<ol>
<li>Scripts for the <em>VIC vSphere Client Plug-In</em> like install, upgrade, or remove</li>
<li>The latest version of the <code>vic-machine</code> utility</li>
</ol>

<p>I´ve already covered this topic in my previous post <a href="https://rguske.github.io/post/vsphere-integrated-containers-part-iii-deployment-of-a-virtual-container-host" target="_blank"> vSphere Integrated Containers Part III: Deployment of a Virtual Container Host</a> right at the beginning.</p>

<p>Open the VIC <em>Getting Started</em> page by entering your VIC Address with port 9443 into a browser and find the download-button under the point <em>Infrastructure Deployment Tools</em>.</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181001_113850.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181001_113850.jpg" width="800"></img></a></center></p>

<p>Otherwise you can go directly to: https://<em>your VIC Appliance address</em>:9443/files/</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181001_113551.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181001_113551.jpg"></img></a></center></p>

<hr />

<h2 id="phase-iii">Phase III</h2>

<p><strong>VIC vSphere Client Plug-In upgrade</strong></p>

<p>Now that we have the new VIC Enginge Bundle available we´ll make use of the <em>Upgrade Script</em> for the <em>VIC vSphere Client Plug-In</em>.</p>

<hr />

<blockquote>
<p><strong>Note!</strong>
This applies only until version VIC 1.4.1!</p>
</blockquote>

<hr />

<p>Use a terminal and you´ll find the script deposited in the path <strong>/vic141/ui/vcsa</strong> on your local computer or remote execution host (wherever you´ve downloaded it).</p>

<pre><code class="language-shell">total 72
drwxr-xr-x@ 6 rguske  staff    192 Aug 16 23:22 .
drwxr-xr-x@ 8 rguske  staff    256 Jul  3 17:37 ..
-rw-r--r--@ 1 rguske  staff    937 Aug 16 23:22 configs
-rwxr-xr-x@ 1 rguske  staff  10364 Jun 22 22:28 install.sh
-rwxr-xr-x@ 1 rguske  staff   6002 Jun 22 22:28 uninstall.sh
-rwxr-xr-x@ 1 rguske  staff  12059 Jun 22 22:28 upgrade.sh
</code></pre>

<p>Execute <code>./upgrade.sh</code> so that the script starts prompting you after neccessary information regarding the vCenter Server target and user credentials. This is how it will look like:</p>

<pre><code class="language-shell">-------------------------------------------------------------
This script will upgrade vSphere Integrated Containers plugin
for vSphere Client (HTML) and vSphere Web Client (Flex).

Please provide connection information to the vCenter Server.
-------------------------------------------------------------
Enter FQDN or IP to target vCenter Server: lab-vcsa67-001.lab.jarvis.local
Enter your vCenter Administrator Username: administrator@jarvis.local
Enter your vCenter Administrator Password:

SHA-1 key fingerprint of host 'lab-vcsa67-001.lab.jarvis.local' is '4F:D3:9B:50:00:31:D9:84:9D:DA:CF:57:21:D6:0D:11:89:78:97:26'
Are you sure you trust the authenticity of this host (yes/no)? yes

-------------------------------------------------------------
Checking existing plugins...
-------------------------------------------------------------
Plugin with key 'com.vmware.vic' is already registered with VC. (Version: 1.3.1.687)
Plugin with key 'com.vmware.vic.ui' is already registered with VC (Version: 1.3.1.687)
The version you are about to install is '1.4.1.1262'.

Are you sure you want to continue (yes/no)? yes

-------------------------------------------------------------
Preparing to upgrade vCenter Extension vSphere Integrated Containers-FlexClient...
-------------------------------------------------------------
Aug 29 2018 23:12:07.794+02:00 INFO  ### Installing UI Plugin ####
Aug 29 2018 23:12:07.919+02:00 INFO  Removing existing plugin to force install
Aug 29 2018 23:12:08.164+02:00 INFO  Removed existing plugin
Aug 29 2018 23:12:08.164+02:00 INFO  Installing plugin
Aug 29 2018 23:12:08.484+02:00 INFO  Installed UI plugin

-------------------------------------------------------------
Preparing to upgrade vCenter Extension vSphere Integrated Containers-H5Client...
-------------------------------------------------------------
Aug 29 2018 23:12:08.535+02:00 INFO  ### Installing UI Plugin ####
Aug 29 2018 23:12:08.664+02:00 INFO  Removing existing plugin to force install
Aug 29 2018 23:12:08.730+02:00 INFO  Removed existing plugin
Aug 29 2018 23:12:08.730+02:00 INFO  Installing plugin
Aug 29 2018 23:12:08.865+02:00 INFO  Installed UI plugin
Aug 29 2018 23:12:09.230+02:00 WARN  ignoring potential product VM vm-321: not powered on
Aug 29 2018 23:12:09.237+02:00 INFO  Found 1 VM(s) tagged as OVA
Aug 29 2018 23:12:09.247+02:00 INFO  Attempting to configure ManagedByInfo
Aug 29 2018 23:12:09.485+02:00 INFO  Successfully configured ManagedByInfo
</code></pre>

<p>If all the entered information were correct and most of the time it depends on the correct user privileges, it will output&hellip;</p>

<pre><code class="language-shell">--------------------------------------------------------------
Upgrade successful. Restart the vSphere Client services. All vSphere Client users must log out and log back in again to see the vSphere Integrated Containersplug-in.
Exited successfully
</code></pre>

<p>Finally and as requested in the last lines of the above output, restart the vSphere Client services on your vCenter Server Appliance.</p>

<pre><code class="language-shell">service-control --stop vsphere-ui &amp;&amp; service-control --start vsphere-ui
service-control --stop vsphere-client &amp;&amp; service-control --start vsphere-client
</code></pre>

<p><center><a href="https://rguske.github.io/img/posts/vic_getting_started/CapturFiles-20180616_100412.jpg"><img src="https://rguske.github.io/img/posts/vic_getting_started/CapturFiles-20180616_100412.jpg" height="260"></img></a></center></p>

<p>In case you are missing something here in my description, you´ll perhaps find your answer here: <a href="https://vmware.github.io/vic-product/assets/files/html/1.4/vic_vsphere_admin/upgrade_h5_plugin_vcsa.html" target="_blank"> Manually Upgrade the vSphere Client Plug-In on vCenter Server Appliance </a></p>

<h2 id="upgrading-v1-4-1-to-v1-4-3">Upgrading v1.4.1 to v1.4.3</h2>

<p>This phase (II) of the VIC Upgrade-process is now obsolete with version 1.4.3. The upgrade of the vSphere (H5) Plug-In is now integrated into the whole process. As you can see through the following output, the question after the <em>VIC UI Plugin</em> upgrade appeared when you start the VIC Appliance upgrade:</p>

<p><code>Upgrade VIC UI Plugin? (y/n):</code> and of course I answered it with <code>y</code> (=yes)&hellip;what else?!</p>

<pre><code class="language-shell">root@vic01 [ /etc/vmware/upgrade ]# ./upgrade.sh
-------------------------------
VIC Appliance Upgrade to v1.4.3
-------------------------------

2018-10-09 21:43:15 [=] Values containing $ (dollar sign), ` (backquote), \' (single quote), &quot; (double quote), and \ (backslash) will not be substituted properly.
2018-10-09 21:43:15 [=] Change any input (passwords) containing these values before running this script.
Enter vCenter Server FQDN or IP: lab-vcsa67-001.lab.jarvis.local
Enter vCenter Administrator Username: admin@jarvis.local
Enter vCenter Administrator Password:
If using an external PSC, enter the FQDN of the PSC instance (leave blank otherwise):
If using an external PSC, enter the PSC Admin Domain (leave blank otherwise):

Please verify the vCenter IP and TLS fingerprint: lab-vcsa67-001.lab.jarvis.local 4F:D3:9B:50:00:31:D9:84:9D:DA:CF:57:21:D6:0D:11:89:78:97:26
Is the fingerprint correct? (y/n): y
Enter vCenter Datacenter of the old VIC appliance: Datacenter-North
Enter old VIC appliance IP: 192.168.100.161
Enter old VIC appliance username: root
Upgrade VIC UI Plugin? (y/n): y
2018-10-09 21:43:58 [=]
-------------------------
Starting upgrade 2018-10-09 21:43:15 +0000 UTC

2018-10-09 21:44:00 [=] Please enter the VIC appliance password for root@192.168.100.161
The authenticity of host '192.168.100.161 (192.168.100.161)' can't be established.
ECDSA key fingerprint is SHA256:MTj3Ak65Uem4uiipiygyOpVJuik7iawz09hFsz7tSM4.
Are you sure you want to continue connecting (yes/no)? yes
Password:
2018-10-09 21:44:09 [=]
2018-10-09 21:44:09 [=] Detected old appliance's version as v1.4.1.
2018-10-09 21:44:09 [=] If the old appliance's version is not detected correctly, please enter &quot;n&quot; to abort the upgrade and contact VMware support.
2018-10-09 21:44:09 [=]
2018-10-09 21:44:09 [=] Do you wish to proceed with upgrade? [y/n]
y
2018-10-09 21:44:17 [=] Continuing with upgrade
2018-10-09 21:44:17 [=]
2018-10-09 21:44:19 [=] Waiting for old VIC appliance to power off
2018-10-09 21:44:35 [=] Waiting for old VIC appliance to power off
2018-10-09 21:44:50 [=] Waiting for old VIC appliance to power off
2018-10-09 21:45:05 [=] Waiting for old VIC appliance to power off
2018-10-09 21:45:20 [=] Waiting for old VIC appliance to power off
2018-10-09 21:45:39 [=] Migrating old disks to new VIC appliance...
2018-10-09 21:45:40 [=] Copying old data disk. Please wait.
2018-10-09 21:45:45 [=] Copying old database disk. Please wait.
2018-10-09 21:45:51 [=] Copying old log disk. Please wait.
2018-10-09 21:45:59 [=] Finished attaching migrated disks to new VIC appliance
2018-10-09 21:45:59 [=] Preparing upgrade environment
2018-10-09 21:45:59 [=] Disabling and stopping Admiral and Harbor
2018-10-09 21:45:59 [=] Registering the appliance in PSC
2018-10-09 21:46:00 [=] Waiting for register appliance...
2018-10-09 21:46:39 [=] Finished preparing upgrade environment
2018-10-09 21:46:39 [=]
-------------------------
Starting VIC UI Plugin Upgrade 2018-10-09 21:43:15 +0000 UTC

2018-10-09 21:46:41 [=]
-------------------------
Starting Admiral Upgrade 2018-10-09 21:43:15 +0000 UTC

2018-10-09 21:46:41 [=] Performing pre-upgrade checks
2018-10-09 21:46:41 [=] Starting Admiral upgrade
2018-10-09 21:47:22 [=] Updating Admiral configuration
2018-10-09 21:47:23 [=] Restarting Admiral
2018-10-09 21:48:12 [=]
-------------------------
Starting Harbor Upgrade 2018-10-09 21:43:15 +0000 UTC

2018-10-09 21:48:12 [=] Performing pre-upgrade checks
2018-10-09 21:48:12 [=] Starting Harbor upgrade
2018-10-09 21:48:12 [=] [=] Shutting down Harbor
2018-10-09 21:48:12 [=] [=] Migrating Harbor configuration and data
2018-10-09 21:48:12 [=] Testing database credentials...
2018-10-09 21:48:14 [=] Backing up harbor config...
2018-10-09 21:48:19 [=] [=] Successfully migrated Harbor configuration and data
2018-10-09 21:48:19 [=] Harbor upgrade complete
2018-10-09 21:48:19 [=] Starting Harbor
2018-10-09 21:48:30 [=] Enabling and starting Admiral and Harbor
2018-10-09 21:48:30 [=]
2018-10-09 21:48:30 [=] -------------------------
2018-10-09 21:48:30 [=] Upgrade completed successfully. Exiting. All vSphere Client users must log out and log back in again twice to see the vSphere Integrated Containers plug-in.
2018-10-09 21:48:30 [=] -------------------------
2018-10-09 21:48:30 [=]
</code></pre>

<p>In the vSphere Client you´ll see an information that plug-ins have been updated and they´ll be ready for use next time you log into vSphere Client.</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181009_115056.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181009_115056.jpg" width="800"></img></a></center></p>

<p>Re-Login</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181009_115536.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181009_115536.jpg" width="800"></img></a></center></p>

<hr />

<h2 id="phase-iv">Phase IV</h2>

<p><strong>Upgrade of the Virtual Container Host(s)</strong></p>

<p>Last but not least we´ll upgrade our Virtual Container Host(s). This will also be done by using the <code>vic-machine</code> utility with the option <code>upgrade</code>. Before I begin, I´ll check all current versions of my running VCH´s.</p>

<p>Use <code>docker --tls version</code> to get the desired information.</p>

<p>For my VCH based and deployed on version 1.3.1 the output looks like:</p>

<pre><code class="language-shell">Client:
 Version:           18.06.1-ce
 API version:       1.25 (downgraded from 1.38)
 Go version:        go1.10.3
 Git commit:        e68fc7a
 Built:             Tue Aug 21 17:21:31 2018
 OS/Arch:           darwin/amd64
 Experimental:      false

Server:
 Engine:
  Version:          1.3.1
  API version:      1.25 (minimum version 1.19)
  Go version:       go1.8.3
  Git commit:       afdab46
  Built:            Mon Feb  5 15:35:58 2018
  OS/Arch:          linux/amd64
  Experimental:     true
</code></pre>

<p>&hellip;and for my VCH based on version 1.4.1 it looks like this:</p>

<pre><code class="language-shell">Client:
 Version:           18.06.1-ce
 API version:       1.25 (downgraded from 1.38)
 Go version:        go1.10.3
 Git commit:        e68fc7a
 Built:             Tue Aug 21 17:21:31 2018
 OS/Arch:           darwin/amd64
 Experimental:      false

Server:
 Engine:
  Version:          1.4.1
  API version:      1.25 (minimum version 1.19)
  Go version:       go1.8.7
  Git commit:       b3a6192
  Built:            Tue Jul  3 15:05:57 2018
  OS/Arch:          linux/amd64
  Experimental:     true
</code></pre>

<p>Now let´s upgrade our VCH from version 1.4.1 to our latest version:</p>

<p><center> <blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/vSphereIntegratedContainers?src=hash&amp;ref_src=twsrc%5Etfw">#vSphereIntegratedContainers</a> 1.4.3 is available with cool new enhancements like shell auto-complete function or vic-machine create --no-proxy option to skip proxying for certain URLs or domains. Read more about the new release here: <a href="https://t.co/f21abf64TQ">https://t.co/f21abf64TQ</a> <a href="https://twitter.com/hashtag/VIC?src=hash&amp;ref_src=twsrc%5Etfw">#VIC</a></p>&mdash; Robert (@vmw_rguske) <a href="https://twitter.com/vmw_rguske/status/1041955154910740480?ref_src=twsrc%5Etfw">September 18, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
 </center></p>

<p>The <code>upgrade</code> option from <code>vic-machine</code> requires the VM-ID from our VCH and we can get this ID by using <code>vic-machine inspect</code>.</p>

<p>That´s the point were you´ll hopefully say to yourself &ldquo;<em>AH! We´ve already made use of this option to get the VCH version displayed</em>&rdquo; and you`re right &ldquo;<em>Watson</em>&rdquo; ;-)!</p>

<p>And I´ve also mentioned that I´ll come back to this point. Because we now will fire up this command from the new VIC Engine Bundle&hellip;</p>

<pre><code class="language-shell">./vic-machine-darwin inspect \
--target lab-vcsa67-001.lab.jarvis.local/Datacenter-North \
--user adm.jarvis@LAB.JARVIS.LOCAL \
--thumbprint 4F:D3:9B:50:00:31:D9:84:9D:DA:CF:57:21:D6:0D:11:89:78:97:26 \
--name vch-elk
</code></pre>

<p>&hellip;and the output will show us this time the following:</p>

<pre><code class="language-shell">INFO[0000] vSphere password for adm.jarvis@LAB.JARVIS.LOCAL:
INFO[0004] ### Inspecting VCH ####
INFO[0004] Validating target
INFO[0005]
INFO[0005] Installer version: v1.4.3-20031-fa9732d
INFO[0005] VCH version: v1.4.1-19562-b3a6192
INFO[0005]
INFO[0005] VCH upgrade status:
INFO[0005] Upgrade available
WARN[0005] Unable to identify address acceptable to host certificate, using assigned client IP as host address.
INFO[0005]
INFO[0005] VCH ID: vm-1190
INFO[0005]
INFO[0005] VCH Admin Portal:
INFO[0005] https://192.168.100.220:2378
INFO[0005]
INFO[0005] Published ports can be reached at:
INFO[0005] 192.168.100.22
INFO[0005]
INFO[0005] Management traffic will use:
INFO[0005] 192.168.100.220
INFO[0005]
INFO[0005] Docker environment variables:
INFO[0005] DOCKER_HOST=192.168.100.220:2376
INFO[0005]
INFO[0005] Connect to docker:
INFO[0005] docker -H 192.168.100.220:2376 --tls info
INFO[0005] Completed successfully
</code></pre>

<blockquote>
<p>INFO[0005] <strong>Installer version: v1.4.3-20031-fa9732d</strong></p>

<p>INFO[0005] <strong>VCH version: v1.4.1-19562-b3a6192</strong></p>

<p>INFO[0005] VCH upgrade status:</p>

<p>INFO[0005] <strong>Upgrade available</strong></p>
</blockquote>

<p><em>Upgrade available</em> sounds good to me! Here we go:</p>

<pre><code class="language-shell">./vic-machine-darwin upgrade \
--target lab-vcsa67-001.lab.jarvis.local/Datacenter-North \
--user administrator@jarvis.local \
--id vm-1190 \
--force
</code></pre>

<p>&hellip;and a couple of seconds later&hellip;</p>

<pre><code class="language-shell">INFO[0000] vSphere password for administrator@jarvis.local:
INFO[0004] ### Upgrading VCH ####
INFO[0004] Validating target
INFO[0004]
INFO[0004] VCH ID: VirtualMachine:vm-1190
INFO[0005] Creating directory [lab-ds-001] vch-elk
INFO[0005] Datastore path is [lab-ds-001] vch-elk
INFO[0005] Uploading ISO images
INFO[0006] Uploading appliance.iso as V1.4.3-20031-FA9732D-appliance.iso
INFO[0016] Uploading bootstrap.iso as V1.4.3-20031-FA9732D-bootstrap.iso
INFO[0023] Switching appliance iso to [lab-ds-001] vch-elk/V1.4.3-20031-FA9732D-appliance.iso
INFO[0023] Setting VM configuration
WARN[0024] If ops-user (jarvis@lab) belongs to the Administrators group, permissions on some resources might have been restricted
INFO[0025] Waiting for IP information
INFO[0025] Waiting for major appliance components to launch
INFO[0035] Obtained IP address for client interface: &quot;192.168.100.220&quot;
INFO[0035] Checking VCH connectivity with vSphere target
INFO[0035] vSphere API Test: https://lab-vcsa67-001.lab.jarvis.local vSphere API target responds as expected
INFO[0121] Completed successfully
</code></pre>

<p>Version check (<code>docker --tls version</code>) again!</p>

<pre><code class="language-shell">Client:
 Version:           18.06.1-ce
 API version:       1.25 (downgraded from 1.38)
 Go version:        go1.10.3
 Git commit:        e68fc7a
 Built:             Tue Aug 21 17:21:31 2018
 OS/Arch:           darwin/amd64
 Experimental:      false

Server:
 Engine:
  Version:          1.4.3
  API version:      1.25 (minimum version 1.19)
  Go version:       go1.8.7
  Git commit:       fa9732d
  Built:            Fri Sep 14 08:14:14 2018
  OS/Arch:          linux/amd64
  Experimental:     true
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>We´ve went through each individual phase of the upgrade-process of vSphere Integrated Containers. The upgrade to a newer version is simple and improvements were made in version 1.4.3.</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181014_113631.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181014_113631.jpg"></img></a></center></p>

<p>When upgrading to a newer version we just have to observe the following aspects:</p>

<ul>
<li>Upgrading vSphere Integrated Containers is not that difficult and it´s well documented. <a href="https://vmware.github.io/vic-product/assets/files/html/1.4/vic_vsphere_admin/upgrading_vic.html" target="_blank"> <em>Upgrading vSphere Integrated Containers</em></a></li>
<li>Upgrade between untagged, open source builds of the same release like 1.4.3 open source build to 1.4.3 official build is not supported</li>
<li>The upgrade of the vSphere Client Plug-In is now in the VIC Appliance upgrade integrated with version 1.4.3</li>
<li>While upgrading the Virtual Conatiner Host(s), the VCH get´s rebooted which means that when you have NOT configured a dedicated Container-Network for your VCH, your application cannot be reached over the VCH IP-Address and it´s exposed port.</li>
</ul>

<blockquote>
<p><em>To avoid this, make use of one of the big benefits vSphere Integrated Containers can leverage here and configure a</em> <strong><em>dedicated Container-Network to your VCH!</em></strong></p>

<p><em>In addition have a look at <a href="https://rguske.github.io/post/vsphere-integrated-containers-part-iv-docker-run-a-container-vm">vSphere Integrated Containers Part IV: docker run a Container-VM</a></em></p>
</blockquote>

<p>You can easily test this by instantiating a (vmwarecna) <a href="https://hub.docker.com/r/vmwarecna/nginx/" target="_blank"> NGINX</a> Container-VM with the <code>--net</code> option, start upgrading the Virtual Container Host and see if the C-VM will become unreachable.</p>

<p>Example: <code>docker --tls run --name vmwarenginx --net vch-blog-net -d -p 8080:80 vmwarecna/nginx</code></p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181014_104814.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181014_104814.jpg" width="800"></img></a></center></p>

<p>While upgrading the VCH, the NGINX Container-VM is still reachable.</p>

<p><center><a href="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181014_105153.jpg"><img src="https://rguske.github.io/img/posts/201808_post_vic_upgrade/CapturFiles-20181014_105153.jpg" width="800"></img></a></center></p>

<p>Please find the Release Notes for vSphere Integrated Containers here: <a href="https://docs.vmware.com/en/VMware-vSphere-Integrated-Containers/" target="_blank">VMware vSphere Integrated Containers Docs</a></p>

<p>I hope you won´t find this post not too long for this kind of topic, but I wanted to be as detailed as possible.</p>

<p><center><strong>Thanks for reading.</strong></center></p>

      </section>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://rguske.github.io/img/profile_robert.jpg" alt="Author" />
          <span class="post-card-author"><a href="https://rguske.github.io/">Robert Guske</a></span>
      </footer>
    </div>
</article>
    </div>

    <nav class="pagination" role="navigation">
      
          <a class="newer-posts" href="https://rguske.github.io/post/youtube-hugo-shortcode-workaround-when-youtube-wont-work/">&larr; <span class="hide">Next Post</span></a>
      
      <span class="page-number">&nbsp;</span>
      
          <a class="older-posts" href="https://rguske.github.io/post/vsphere-integrated-containers-part-iv-docker-run-a-container-vm/"><span class="hide">Previous Post</span> &rarr;</a>
      
    </nav>

    
    
    

  </div>
</main>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="https://rguske.github.io/"></a> © All rights reserved -2018 <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="https://rguske.github.io/">Latest Posts</a>
        
        <a href="https://twitter.com/vmw_rguske" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/rguske" target="_blank" rel="noopener">Github</a>
        <a href="https://www.linkedin.com/in/robert-guske-830853111" target="_blank" rel="noopener">LinkedIn</a>
        
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://rguske.github.io/js/jquery.fitvids.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-122353302-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>



</body></html>
