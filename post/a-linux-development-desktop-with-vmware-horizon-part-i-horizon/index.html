<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>A Linux Development Desktop with VMware Horizon - Part I: Horizon &middot; </title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://rguske.github.io/favicon.ico" />
    <link rel="canonical" href="https://rguske.github.io/post/a-linux-development-desktop-with-vmware-horizon-part-i-horizon/" />

     <meta name="description" content="I often thought about writing down my experiences on the topics of Jumphosts, Shell-modifications and useful tools in a series of blog posts, but I hadn¬¥t found" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://rguske.github.io/img/devdesk_part_i_cover.png"/>
    
 
    <meta name="twitter:title" content="A Linux Development Desktop with VMware Horizon - Part I: Horizon"/>
    <meta name="twitter:description" content="I often thought about writing down my experiences on the topics of Jumphosts, Shell-modifications and useful tools in a series of blog posts, but I hadn¬¥t found"/>
    <meta name="twitter:url" content="https://rguske.github.io/post/a-linux-development-desktop-with-vmware-horizon-part-i-horizon/" />
    <meta name="twitter:site" content="@vmw_rguske"/>

    <meta property="og:site_name" content="" />
    <meta property="og:title" content="A Linux Development Desktop with VMware Horizon - Part I: Horizon &middot; Robert Guske" />
    <meta property="og:url" content="https://rguske.github.io/post/a-linux-development-desktop-with-vmware-horizon-part-i-horizon/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="I often thought about writing down my experiences on the topics of Jumphosts, Shell-modifications and useful tools in a series of blog posts, but I hadn¬¥t found" />

    <meta property="article:published_time" content="2020-02-27T16:34:48&#43;01:00" />
    <meta property="article:tag" content="February2020" /><meta property="article:tag" content="Linux" /><meta property="article:tag" content="Horizon" /><meta property="article:tag" content="VDI" />

    <meta property="og:image" content="https://rguske.github.io/img/devdesk_part_i_cover.png"/>


    <meta name="generator" content="Hugo 0.57.2" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://rguske.github.io/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="https://rguske.github.io/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
     <link rel="stylesheet" href="https://rguske.github.io/dist/css/tagformatting.css" /> 

     

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
    <script>
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#343c66",
          "text": "#cfcfe8"
        },
        "button": {
          "background": "#f71559"
        }
      }
    })});
    </script>

</head>


<body class="ctsingle">

  <div class="site-wrapper">

<header class="site-header outer "  style="background-image: url(https://rguske.github.io/img/blog_cover_usercon.jpeg)"  >
  <div class="inner">
    <div class="site-header-content">
      <h1 class="site-title"> Robert Guske  </h1>
      <h2 class="site-description">&#34;Sometimes you gotta run before you can walk!&#34; </h2>
        <cite class="site-description">Anthony Edward &#34;Tony&#34; Stark, also known as IRON MAN </cite>
    </div>

    <nav class="site-nav">
      <div class="site-nav-left"><ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="https://rguske.github.io/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://rguske.github.io/about">About Me</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://rguske.github.io/post/vmware-microsites-you-should-bookmark">VMware Microsites</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://github.com/rguske">Github Repo</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://rguske.github.io/disclaimer">Disclaimer</a>
            </li>
        
            <li class="nav-current" role="menuitem">
              <a href="https://rguske.github.io/post/">Posts</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/vmw_rguske" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/rguske" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    <a class="social-link" href="https://www.linkedin.com/in/robert-guske-830853111" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 50 512 512"><path d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683 C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615 c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915 s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z" /></svg></a>

                    
        </div>  
            
      </div>

    </nav>  

  </div>
</header>


<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
    <div class="post-feed">
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://rguske.github.io/post/a-linux-development-desktop-with-vmware-horizon-part-i-horizon/">
      <div class="post-card-image" style="background-image: url(https://rguske.github.io/img/devdesk_part_i_cover.png)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://rguske.github.io/post/a-linux-development-desktop-with-vmware-horizon-part-i-horizon/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #February2020 
              #Linux 
              #Horizon 
              #VDI  </span>
              
              <h2 class="post-card-title">A Linux Development Desktop with VMware Horizon - Part I: Horizon</h2>
          </header>
      </a>
      <section class="post-card-excerpt" style="padding: 0 25px;">
          

<p>I often thought about writing down my experiences on the topics of <em>Jumphosts</em>, <em>Shell-modifications</em> and <em>useful tools</em> in a series of blog posts, but I hadn¬¥t found the right moment, until I saw the following Tweet, where Alex asked his followers how they get access to a Linux system if they aren¬¥t running Linux on their workstation (locally).</p>

<p><center> <blockquote class="twitter-tweet"><p lang="in" dir="ltr">Ubuntu 18.04 VDI desktop</p>&mdash; Mark Brookfield (@virtualhobbit) <a href="https://twitter.com/virtualhobbit/status/1210952121488728066?ref_src=twsrc%5Etfw">December 28, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
 </center></p>

<p>Similar to Mark¬¥s answer, I¬¥m also using a VDI (Virtual-Desktop-Infrastructure) desktop for my purposes and I began writing this series&hellip;back in January&hellip;time passed by and due to other projects I worked on and which demanded a lot of my attention (<a href="https://twitter.com/search?q=vCenter%20Event%20Broker%20Appliance&src=typed_query" target="_blank">#VEBA</a> üòÅ), it took a little bit longer to publish them.</p>

<p><strong>But NOW!</strong></p>

<hr />

<p>Having a suitable <em>Jumphost</em>, <em>Remotehost</em>, <em>Development-workstation</em> or however you like to call the system that you connect to, to have access to the appropriate tools and applications available, comes in very handy when you reach the limits or get stuck with your local machine.</p>

<p><strong>Examples:</strong></p>

<ul>
<li>[Ops] Deploying an OVA (Open virtualization Appliance) which is located locally on your workstation into your remote Datacenter via VPN isn¬¥t really a good idea.</li>
<li>[Dev] I recently had to repeatedly create new versions of an OVA for testing purposes as changes were made to the code. Building the OVA takes time.</li>
</ul>

<p>And another very important aspect of having a &ldquo;Developer-friendly&rdquo; environment quickly available comes into play! Let¬¥s consider the rise of Kubernetes for example. Organizations today will perhaps reach a point, where it will be necessary to employ external developers and engineers (e.g. <a href="https://en.wikipedia.org/wiki/Site_Reliability_Engineering" target="_blank">SRE¬¥s</a>, <a href="https://en.wikipedia.org/wiki/Reliability_engineering" target="_blank">PRE¬¥s</a>) and provide a environment to them, that is on the one hand organization compliant and on the other hand offers sufficient flexibility and appropriate tools to these developers and engineers.</p>

<p>With this series of posts, I¬¥d like to demonstrate how you can build such an environment for the described use-cases on your own and what¬¥s necessary to offer it as a VDI desktop to your team or external employers. This will include the setup of a <em>VMware Horizon Connection Server (broker for client connections)</em>, the installation, configuration and preperation of the Linux distributions <span style="color:#018914">Ubuntu</span> and <span style="color:#6003B6">CentOS</span> and how you can turn them into <strong>a universal workbench for development and operations.</strong></p>

<p><strong>Please give 3 minutes of your precious time</strong> for the following recording to get an idea of what you can expect at the end of these three articles.</p>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/iWiryTFG4Mg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>


<p><center><em>Video I: SSO and HTML5 feature in VMware Horizon</em></center></p>

<hr />

<h2 id="my-mindnode-for-building-a-development-desktop">My Mindnode for building a Development Desktop</h2>

<p><a href="https://github.com/rguske/rguske.github.io/blob/master/img/posts/201912_development_desktop/rg_022020_mindnode_post_devdesk.png" target="_blank"><strong>Download</strong></a></p>

<p><center><a href="https://rguske.github.io/img/posts/201912_development_desktop/rg_022020_mindnode_post_devdesk.png"><img src="https://rguske.github.io/img/posts/201912_development_desktop/rg_022020_mindnode_post_devdesk.png"></img></a></center></p>

<p><center><em>Figure I: Mindnode Development Desktop</em></center></p>

<hr />

<h1 id="setup-vmware-horizon-connection-server-v-7-11">Setup VMware Horizon Connection Server (v.7.11)</h1>

<p>The VMware Horizon Connection Server is the broker for your client connections which authenticates users through Windows Active Directory and directs the request to the appropriate virtual machine (<em>Figure II</em>).</p>

<p><center><a href="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200218_034842.jpg"><img src="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200218_034842.jpg"></img></a></center></p>

<p><center><em>Figure II: VMware Horizon Client authenticating to a Connection Server</em></center></p>

<p><em>Source:</em> <a href="https://techzone.vmware.com/resource/workspace-one-and-horizon-reference-architecture#component-design-horizon-architecture" target="_blank">Digital Workspace Tech Zone - VMware Workspace ONE and VMware Horizon Reference Architecture</a></p>

<p>If all <a href="https://docs.vmware.com/en/VMware-Horizon-7/7.11/horizon-installation/GUID-68621B8E-F018-4BC4-811A-5CF76B55DB2C.html#GUID-68621B8E-F018-4BC4-811A-5CF76B55DB2C" target="_blank">PREREQUISITES</a> are given (<em>Figure I: Mindnode Development Desktop</em>), the installation itself is really quick and simple.</p>

<p><strong>Short overview</strong></p>

<ul>
<li>Windows Server VM (W2k8R2 - W2k19) which is part of a MS Domain

<ul>
<li>The Connection Server cannot be installed on a Domain Controller (e.g. for a PoC or a Homelab)</li>
</ul></li>
<li>Download and install the Connection Server v.7.11 installer (VMware-Horizon-Connection-Server-x86_64-7.11.0.exe / ~250 MB)</li>
<li>Select the <em>View Standard Server role</em></li>
<li>Choose a User or a Group (local or AD) to authorize them for Horizon 7 administration</li>
</ul>

<p>That¬¥s it roughly! Therefore, it¬¥s not necessary for me to go into the details here and instead, I¬¥d like to refer you to the following sources:</p>

<p><strong>VMware Docs</strong></p>

<ul>
<li><em>Install Horizon Connection Server with a New Configuration</em> - <a href="https://docs.vmware.com/en/VMware-Horizon-7/7.11/horizon-installation/GUID-9F93A59F-C35F-4388-B3D6-CE4F50D8BAFD.html">https://docs.vmware.com/en/VMware-Horizon-7/7.11/horizon-installation/GUID-9F93A59F-C35F-4388-B3D6-CE4F50D8BAFD.html</a></li>
</ul>

<p><strong>Post</strong> by <a href="https://twitter.com/cstalhood" target="_blank">Carl Stalhood</a></p>

<ul>
<li><em>Install Horizon 7 Standard Connection Server</em> by - <a href="https://www.carlstalhood.com/vmware-horizon-7-connection-server/">https://www.carlstalhood.com/vmware-horizon-7-connection-server/</a></li>
</ul>

<hr />

<h1 id="install-a-linux-vm">Install a Linux-VM</h1>

<h2 id="select-a-linux-distribution">Select a Linux Distribution</h2>

<p>In this post, I¬¥ll concentrate just on <span style="color:#018914">Ubuntu 18.04 LTS</span> and <span style="color:#6003B6">CentOS 8.0</span> but in case that this is not your pick, you¬¥ll find all Linux distributions that are supported for Horizon Agent on page 14 of the official installation guide here:<a href="https://docs.vmware.com/en/VMware-Horizon-7/7.11/linux-desktops-setup.pdf" target="_blank"> <em>&ldquo;Setting Up Horizon 7 for Linux Desktops&rdquo;</em></a>.</p>

<h2 id="download-linux-installation-iso">Download Linux installation iso</h2>

<ul>
<li><span style="color:#018914"><strong>Ubuntu 18.04 LTS:</strong> <a href="https://ubuntu.com/download/desktop/">https://ubuntu.com/download/desktop/</a></li>
<li><span style="color:#6003B6"><strong>CentOS 8.0</strong> (at this time only 8.0 is supported!): <a href="http://isoredirect.centos.org/centos/8/isos/x86_64/">http://isoredirect.centos.org/centos/8/isos/x86_64/</a></li>
</ul>

<h2 id="create-a-new-virtual-machine">Create a new Virtual Machine</h2>

<p>Now that your iso is ready to be mounted let¬¥s create a new Virtual Machine. Choose your distro from the list and configure your vHardware. I followed the official recommendation for <em>&ldquo;Improved video playback in a 2D desktop (page 23)</em>.</p>

<p><center><a href="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200219_123512.jpg"><img src="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200219_123512.jpg"></img></a></center></p>

<p><center><em>Figure III: Linux Distribution &amp; vHardware Settings</em></center></p>

<p>For <span style="color:#6003B6">CentOS</span> I chose the &ldquo;<em>Workstation</em>&rdquo; option. Minimal installation is sufficient for <span style="color:#018914">Ubuntu</span>.</p>

<p><center><a href="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200224_093014.jpg"><img src="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200224_093014.jpg"></img></a></center></p>

<p><center><em>Figure IV: Installation options CentOS 8.0 &amp; Ubuntu LTS 18.04</em></center></p>

<p>Compared to CentOS, it¬¥s not possible under Ubuntu to make the system settings like e.g. the Network-settings or NTP during the initial phase of the installation. So make sure that you configure everything after Ubuntu is booted for the first time.</p>

<h2 id="ntp-ubuntu">NTP (Ubuntu)</h2>

<p>Proper network time synchronization is an essential part of monitoring a network and resolving issues within it!</p>

<pre><code class="language-shell">sudo apt install ntp
systemctl status ntp
timedatectl list-timezones
timedatectl set-timezone Europe/Berlin
</code></pre>

<p>Set your NTP server in the <code>/etc/ntp.conf</code> file. Chose an server pool closest to your location (<a href="https://www.ntppool.org/zone">https://www.ntppool.org/zone</a>) and restart the ntp.service (<code>systemctl restart ntp</code>) after you¬¥ve finished your configuration.</p>

<h2 id="ssh-ubuntu">SSH (Ubuntu)</h2>

<p>Activating <code>SSH</code> makes all the configurations, which will follow, a lot easier (<em>copy &amp; paste</em>) in comparison to using the VMware Remote Console. <em>OpenSSH</em> has to be installed on Ubuntu:</p>

<p><span style="color:#018914"><strong>Ubuntu:</strong></span></p>

<pre><code class="language-shell">sudo apt install openssh-server
</code></pre>

<p><span style="color:#6003B6"><strong>CentOS:</strong></span> <em>OpenSSH server is installed and enabled by default.</em></p>

<p>Check that the service is <span style="color:#168407"><em>Active</em></span> and running:</p>

<pre><code class="language-shell">systemctl status sshd.service
</code></pre>

<h2 id="packages-and-module-dependencies">Packages and module dependencies</h2>

<p>We¬¥re planning to join our system into a Active Directory Domain and also want to install the VMware Horizon View Agent, which is necessary for adding our machine to a Desktop-Pool later on. Before we can continue, it¬¥s necessary to eliminate some dependencies by installing some packages upfront.</p>

<p><strong>ATTENTION (CentOS): Do not run <code>yum update</code>!</strong></p>

<p>Normally, the first step I do after setting up a fresh Linux system, is the update of every currently installed package of it (<code>apt update</code> / <code>yum update</code>). You can run the update and upgrade &ldquo;safely&rdquo; for Ubuntu but <strong>NOT</strong> for CentOS 8.0. The <em>VMware Horizon View Agent</em> does not support <strong><em>gnome-shell version 3.3x</em></strong>. If you run the <code>sudo yum update</code> command, the gnome-shell will be updated and this leads to the following error:</p>

<pre><code class="language-shell">The version of gnome shell 3.32.2 isn't matched,\n
                       try to replace default version.
Don't support 8.1.1911, disable sso
</code></pre>

<p><strong>&ldquo;Disable SSO&rdquo;</strong> isn¬¥t what we want!</p>

<p>I also tried to exclude the package update for the <a href="https://en.wikipedia.org/wiki/GNOME_Shell" target="_blank"><em>GNOME Shell</em></a> by excluding it as well as <a href="https://en.wikipedia.org/wiki/Mutter_(software)" target="_blank"><em>Mutter</em></a> from the yum.conf file&hellip;</p>

<pre><code class="language-shell">sudo vim /etc/yum.conf

exclude=gnome* mutter*
</code></pre>

<p>&hellip;but this will cause the system to boot with a black-screen. I got the internal feedback, that we¬¥ll support CentOS 8.1 (gnome-shell 3.3x) with Horizon v.7.12.</p>

<p><strong>Big Thanks</strong> to <a href="https://twitter.com/HilkoLantinga" target="_blank">Hilko Lantinga</a> for your support here.</p>

<p>As already mentioned, normally I update my freshly installed system immediately after the first boot! Let¬¥s do this, but only for Ubuntu:</p>

<pre><code class="language-shell">sudo apt -y update &amp;&amp; sudo apt -y upgrade &amp;&amp; sudo reboot
</code></pre>

<p><strong>Now</strong> that our system has a current state, we will install the needed packages which are necessary to proceed further.</p>

<p><span style="color:#018914"><strong>Ubuntu:</strong></span></p>

<pre><code class="language-shell">sudo apt -y install open-vm-tools-desktop vim curl git build-essential realmd python python-dbus python-gobject
</code></pre>

<p><span style="color:#6003B6"><strong>CentOS:</strong></span></p>

<pre><code class="language-shell">sudo dnf -y install sssd oddjob oddjob-mkhomedir adcli samba-common-tools
</code></pre>

<hr />

<h1 id="single-sign-on">Single Sign-On</h1>

<p><em>Source: <a href="https://docs.vmware.com/en/VMware-Horizon-7/7.11/linux-desktops-setup/GUID-4532309E-F219-4FEC-ADC4-B62B5E67BC8F.html" target="_blank">VMware Horizon 7: Setting Up Single Sign-On</a></em></p>

<p>The Horizon Single Sign-On feature gives us the great ability to connect to our Linux system via the Horizon View Client (<em>Video I &amp; Figure II</em>) with an, on the Desktop-Pool level, entitled Active Directory user. This also includes the creation of users home directory if the user logs in for the first time. We have to integrate our Desktop with an Active Directory first to make use of SSO.</p>

<h2 id="integrating-ubuntu-with-active-directory">Integrating Ubuntu with Active Directory</h2>

<p><em>Source: <a href="https://docs.vmware.com/en/VMware-Horizon-7/7.11/linux-desktops-setup/GUID-66FC1A47-616D-4240-A874-2FA07F0C6EF2.html" target="_blank">VMware Horizon 7: PowerBroker Identity Services Open (PBISO)</a></em></p>

<p><span style="color:#018914"><strong>Ubuntu:</strong></span></p>

<p>Pbis-open Releases: <a href="https://github.com/BeyondTrust/pbis-open/releases">https://github.com/BeyondTrust/pbis-open/releases</a></p>

<p><strong>Download and installation:</strong></p>

<pre><code class="language-shell">wget https://github.com/BeyondTrust/pbis-open/releases/download/9.1.0/pbis-open-9.1.0.551.linux.x86_64.deb.sh
chmod +x pbis-open-9.1.0.551.linux.x86_64.deb.sh
sudo ./pbis-open-9.1.0.551.linux.x86_64.deb.sh
</code></pre>

<p><strong>Domain join:</strong></p>

<pre><code class="language-shell">sudo domainjoin-cli --loglevel info join jarvis.lab admin@jarvis.lab

Joining to AD Domain:   jarvis.lab
With Computer DNS Name: devdesk-ubuntu.jarvis.lab
admin@JARVIS.LABs password:
Warning: System restart required
Your system has been configured to authenticate to Active Directory for the first time.  It is recommended that you restart your system to ensure that all applications recognize the new settings.
SUCCESS
</code></pre>

<p>If you get the following error during the domain join&hellip;</p>

<pre><code class="language-shell">Error: DNS_ERROR_BAD_PACKET [code 0x0000251e]

A bad packet was received from a DNS server. Potentially the requested address does not exist.
</code></pre>

<p>&hellip;then the following applies: <em>&ldquo;It&rsquo;s not DNS&rdquo;</em>&hellip;<em>&ldquo;There&rsquo;s no way it&rsquo;s DNS&rdquo;</em>&hellip;<strong>It was DNS!</strong>. Make sure DNS is set up properly.</p>

<p><strong>Default configuration for domain users:</strong></p>

<pre><code class="language-shell">sudo /opt/pbis/bin/config UserDomainPrefix jarvis
sudo /opt/pbis/bin/config AssumeDefaultDomain true
sudo /opt/pbis/bin/config LoginShellTemplate /bin/bash
sudo /opt/pbis/bin/config HomeDirTemplate %H/%U
</code></pre>

<p>Edit the <strong>/etc/pamd.d/common-session</strong> file and <strong>replace</strong> the line <strong><code>session optional pam_lsass.so</code></strong> with <strong><code>session [success=ok default=ignore] pam_lsass.so</code></strong>, save and quite (<code>wq!</code>) and reboot the system.</p>

<p><strong>Note:</strong> Updating the Horizon Agent will require that this setting must be performed again.</p>

<hr />

<h2 id="integrating-centos-8-with-active-directory">Integrating CentOS 8 with Active Directory</h2>

<p><em>Source: <a href="https://docs.vmware.com/en/VMware-Horizon-7/7.11/linux-desktops-setup/GUID-93F4CA16-5F47-47BE-B28C-E8A7901E0391.html" target="_blank"> VMware Horizon 7: Use the Realmd Join Solution for RHEL/CentOS 8.0</a></em></p>

<p>To have the ability to connect with an AD user to our desktop, we have to join an Active Directory domain. <code>realmd</code> will be the tool of our choice to join an Active Directory domain. It¬¥s installed on CentOS by default.</p>

<p><span style="color:#6003B6"><strong>CentOS:</strong></span></p>

<pre><code class="language-shell">sudo realm discover -vvv jarvis.lab
</code></pre>

<pre><code class="language-shell"> * Resolving: _ldap._tcp.jarvis.lab
 * Performing LDAP DSE lookup on: 10.10.13.10
 * Successfully discovered: jarvis.lab
jarvis.lab
  type: kerberos
  realm-name: JARVIS.LAB
  domain-name: jarvis.lab
  configured: no
  server-software: active-directory
  client-software: sssd
  required-package: oddjob
  required-package: oddjob-mkhomedir
  required-package: sssd
  required-package: adcli
  required-package: samba-common-tools
</code></pre>

<p>That looks g00d! So the next step is joining the discovered realm. Execute <code>sudo realm join -v -U admin@JARVIS.LAB JARVIS.LAB</code> and wait until your terminal shows you the result. The <code>-v</code> option will give you a verbose output.</p>

<pre><code class="language-shell">sudo realm join -v -U admin@JARVIS.LAB JARVIS.LAB
</code></pre>

<p>Last to-do at this point is to edit the <code>/etc/sssd/sssd.conf</code>. Add <code>ad_gpo_map_interactive = +gdm-vmwcred</code>, <code>simple_allow_groups = &quot;Your-AD-User-Group&quot;</code> under the [domain/domain name] section and set the value for <code>use_fully_qualified_names</code> to <code>= False</code>.</p>

<p>Example:</p>

<pre><code class="language-shell">sudo vim /etc/sssd/sssd.conf

[sssd]
domains = jarvis.lab
config_file_version = 2
services = nss, pam

[domain/jarvis.lab]
ad_domain = jarvis.lab
krb5_realm = JARVIS.LAB
realmd_tags = manages-system joined-with-adcli
cache_credentials = True
id_provider = ad
krb5_store_password_if_offline = True
default_shell = /bin/bash
ldap_id_mapping = True
use_fully_qualified_names = False
fallback_homedir = /home/%d/%u
access_provider = ad
ad_gpo_map_interactive = +gdm-vmwcred
simple_allow_groups = labadmins@JARVIS.LAB
</code></pre>

<p>We are going to use <em>Gnome Classic</em> for the SSO login for CentOS 8.0. Remove all the desktop startup files from the <code>/usr/share/xsession</code> directory, except the one for <em>Gnome Classic</em>.</p>

<pre><code class="language-shell">cd /usr/share/xsessions/
ls -rtl
-rw-r--r--. 1 root root 8471 May 15  2019 gnome-custom-session.desktop
-rw-r--r--. 1 root root 1303 May 15  2019 gnome.desktop
-rw-r--r--. 1 root root 1303 May 15  2019 gnome-xorg.desktop
-rw-r--r--. 1 root root 1394 May 17  2019 gnome-classic.desktop
sudo mkdir backup
sudo mv *.desktop backup/
sudo mv backup/gnome-classic.desktop ./
</code></pre>

<p><strong>Reboot</strong> the system.</p>

<hr />

<h1 id="install-horizon-view-agent">Install Horizon View Agent</h1>

<p>As a next step we¬¥re going to install the VMware View Agent which must be installed on virtual machines that are managed by vCenter Server so that View Connection Server can communicate with them.</p>

<p><strong>Download:</strong> <a href="https://www.vmware.com/go/download-horizon">https://www.vmware.com/go/download-horizon</a></p>

<p><strong>Tip:</strong> I¬¥ve downloaded the Agent locally first and copied it then via <code>scp</code> into my VM(s).</p>

<pre><code class="language-shell">scp /Users/rguske/Downloads/VMware-horizonagent-linux-x86_64-7.11.0-15238356.tar.gz jarvis@devdesk-centos:/home/jarvis/Downloads
</code></pre>

<p>Unpack the tarball, go into the unpacked directory and execute the <code>install_viewagent.sh</code> script.</p>

<pre><code class="language-shell">tar -zxvf VMware-horizonagent-linux-x86_64-7.11.0-15238356.tar.gz
cd VMware-horizonagent-linux-x86_64-7.11.0-15238356/
~/Downloads/VMware-horizonagent-linux-x86_64-7.11.0-15238356$ ./install_viewagent.sh -A yes
</code></pre>

<ul>
<li><em>Regarding the used command options and arguments</em> - <a href="https://docs.vmware.com/en/VMware-Horizon-7/7.11/linux-desktops-setup/GUID-09A3F97C-47FE-4ABF-B68C-E42AE26632CC.html#GUID-09A3F97C-47FE-4ABF-B68C-E42AE26632CC">https://docs.vmware.com/en/VMware-Horizon-7/7.11/linux-desktops-setup/GUID-09A3F97C-47FE-4ABF-B68C-E42AE26632CC.html#GUID-09A3F97C-47FE-4ABF-B68C-E42AE26632CC</a></li>
</ul>

<p>Now set the correct <em>SSO Desktop Type</em> for the View Agent (see page 18 and 107). Run <code>sudo vim /etc/vmware/viewagent-custom.conf</code> and uncomment the necessary line for your desktop environment.</p>

<ul>
<li><span style="color:#018914"><strong>Ubuntu 18.04</strong></span> = <em>SSODesktopType=UseGnomeClassic</em></li>
<li><span style="color:#6003B6"><strong>CentOS</strong></span> = <em>SSODesktopType=UseGnomeClassic</em></li>
</ul>

<p>On the way down through the <em>viewagent-custom.conf</em> you came by a point where you can define a subnet for the View-Agent. If you like to install Docker on your desktop, as I would assume, you have to uncomment the example and replace the CIDR with yours.</p>

<p><strong>In my case:</strong> <em>Subnet=10.10.13.0/26</em></p>

<p>Otherwise you won¬¥t be able to connect to your desktop anymore after installing Docker. Save and exit the file with <code>:wq!</code>.</p>

<h1 id="create-a-manual-desktop-pool">Create a Manual Desktop Pool</h1>

<p>Now that the work on the prerequisites for adding a VM to a Horizon Pool is complete, it¬¥s time to setup a &ldquo;<em>Manual Desktop Pool</em>&rdquo; for our Desktop. Creating a <em>Manual Desktop Pool</em> is pretty straight forward and well described in VMware¬¥s official documentation.</p>

<p><em>Source: <a href="https://docs.vmware.com/en/VMware-Horizon-7/7.11/linux-desktops-setup/GUID-0E3E3C7F-620B-496F-8C20-BAE6F93B817C.html" target="_blank">Create a Manual Desktop Pool for Linux</a></em></p>

<p><strong>Mandatory settings are:</strong></p>

<ul>
<li><strong>Default display protocol:</strong> VMware Blast</li>
<li><strong>Allow users to choose protocol:</strong> No</li>
<li><strong>3D Renderer:</strong> Manage using vSphere Client for 2D or vDGA desktop and NVIDIA GRID vGPU for vGPU desktop</li>
</ul>

<p>By the end, it should look similar to what you can see on <em>Figure V</em>.
<center><a href="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200204_101435.jpg"><img src="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200204_101435.jpg"></img></a></center></p>

<p><center><em>Figure V: Manual desktop pool(s)</em></center></p>

<p>Since you¬¥ve added the Linux-VM to your new desktop pool, it¬¥ll appear under <em>Machines</em> on the left site. This section will give you a quick overview with some helpful details, like the status and version of the View Agent as well as the DNS name of your system for example. BTW! Regarding DNS&hellip;avoid mistakes like the ones I did&hellip;üòê&hellip;<em>Figure VI</em>.</p>

<p><center><a href="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200212_103007.jpg"><img src="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200212_103007.jpg"></img></a></center></p>

<p><center><em>Figure VI: DNS Name = Shortname</em></center></p>

<p>Let¬¥s bring this into the correct form:</p>

<pre><code class="language-shell">sudo hostnamectl set-hostname devdesk-ubuntu.jarvis.lab
</code></pre>

<p>Doublecheck if the changes got applied:</p>

<pre><code class="language-shell">hostname -f
</code></pre>

<p>Way better! üëá (<em>Figure V</em>)
<center><a href="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200204_103350.jpg"><img src="https://rguske.github.io/img/posts/201912_development_desktop/CapturFiles-20200204_103350.jpg"></img></a></center></p>

<p><center><em>Figure VII: DNS Name = FQDN</em></center></p>

<p>You should now be able to connect to your Desktop-Pool via the <a href="https://my.vmware.com/en/web/vmware/info/slug/desktop_end_user_computing/vmware_horizon_clients/5_0" target="_blank"><em>Horizon Client</em></a>.</p>

<hr />

<p><strong>Continue with Part II:</strong> <a href="https://rguske.github.io/post/a-linux-development-desktop-with-vmware-horizon-part-ii-applications/"> A Linux Development Desktop with VMware Horizon - Part II: Applications</a></p>

<hr />

<h2 id="center-thanks-for-reading-center"><center><strong>Thanks for reading.</strong></center></h2>

      </section>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://rguske.github.io/img/profile_robert.jpg" alt="Author" />
          <span class="post-card-author"><a href="https://rguske.github.io/">Robert Guske</a></span>
      </footer>
    </div>
</article>
    </div>
    <section class="tags">    
      <a href='https://rguske.github.io/tags/february2020/'
        class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">February2020</a>
    
      <a href='https://rguske.github.io/tags/linux/'
        class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Linux</a>
    
      <a href='https://rguske.github.io/tags/horizon/'
        class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Horizon</a>
    
      <a href='https://rguske.github.io/tags/vdi/'
        class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">VDI</a>
    </section>
    <nav class="pagination" role="navigation">

      

      <time class="" datetime="2020-02-27T16:34:48&#43;01:00">February 27, 2020</time>

      <span class="page-number">&nbsp;</span>
      
          <a class="older-posts" href="https://rguske.github.io/post/a-linux-development-desktop-with-vmware-horizon-part-ii-applications/"><span class="hide">Previous Post</span> &rarr;</a>
      
    </nav>

    
    

  </div>
</main>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="https://rguske.github.io/"></a> ¬© All rights reserved -2018 <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="https://rguske.github.io/">Latest Posts</a>
        
        <a href="https://twitter.com/vmw_rguske" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/rguske" target="_blank" rel="noopener">Github</a>
        <a href="https://www.linkedin.com/in/robert-guske-830853111" target="_blank" rel="noopener">LinkedIn</a>
        
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://rguske.github.io/js/jquery.fitvids.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-122353302-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>



</body></html>
