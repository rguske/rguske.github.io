function MapboxLanguage(e){if(e=Object.assign({},e),!(this instanceof MapboxLanguage))throw new Error("MapboxLanguage needs to be called with the new keyword");this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=e.defaultLanguage,this._isLanguageField=e.languageField||/^name_/,this._getLanguageField=e.getLanguageField||function(t){return t==="mul"?"name":`name_${t}`},this._languageSource=e.languageSource||null,this._languageTransform=e.languageTransform,this._excludedLayerIds=e.excludedLayerIds||[],this.supportedLanguages=e.supportedLanguages||["ar","de","en","es","fr","it","ja","ko","mul","pt","ru","vi","zh-Hans","zh-Hant"]}const isTokenField=/^\{name/;function isFlatExpressionField(e,t){const n=Array.isArray(t)&&t[0]==="get";return n&&isTokenField.test(t[1])&&console.warn("This plugin no longer supports the use of token syntax (e.g. {name}). Please use a get expression. See https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/ for more details."),n&&e.test(t[1])}function adaptNestedExpressionField(e,t,n){if(Array.isArray(t))for(let s=1;s<t.length;s++)Array.isArray(t[s])&&(isFlatExpressionField(e,t[s])&&(t[s][1]=n),adaptNestedExpressionField(e,t[s],n))}function adaptPropertyLanguage(e,t,n){if(isFlatExpressionField(e,t)&&(t[1]=n),adaptNestedExpressionField(e,t,n),t[0]==="get"&&t[1]==="name"){const e=t.slice(),s=["get",n];t=["coalesce",s,e]}return t}function changeLayerTextProperty(e,t,n,s){return t.layout&&t.layout["text-field"]&&s.indexOf(t.id)===-1?Object.assign({},t,{layout:Object.assign({},t.layout,{"text-field":adaptPropertyLanguage(e,t.layout["text-field"],n)})}):t}function findStreetsSource(e){const t=Object.keys(e.sources).filter(t=>{const n=e.sources[t].url;return n&&n.indexOf("mapbox.mapbox-streets-v8")>-1||/mapbox-streets-v[1-9][1-9]/.test(n)});if(!t.length)throw new Error('If using MapboxLanguage with a Mapbox style, the style must be based on vector tile version 8, e.g. "streets-v11"');return t[0]}MapboxLanguage.prototype.setLanguage=function(e,t){if(this.supportedLanguages.indexOf(t)<0)throw new Error(`Language ${t} is not supported`);const n=this._languageSource||findStreetsSource(e);if(!n)return e;const o=this._getLanguageField(t),i=this._isLanguageField,a=this._excludedLayerIds,r=e.layers.map(e=>e.source===n?changeLayerTextProperty(i,e,o,a):e),s=Object.assign({},e,{layers:r});return this._languageTransform?this._languageTransform(s,t):s},MapboxLanguage.prototype._initialStyleUpdate=function(){const e=this._map.getStyle(),t=this._defaultLanguage||browserLanguage(this.supportedLanguages);this._map.setStyle(this.setLanguage(e,t))};function browserLanguage(e){const t=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,s=t&&t.split("-");let n=t;return s.length>1&&(n=s[0]),e.indexOf(n)>-1?n:null}MapboxLanguage.prototype.onAdd=function(e){return this._map=e,this._map.on("style.load",this._initialStyleUpdate),this._container=document.createElement("div"),this._container},MapboxLanguage.prototype.onRemove=function(){this._map.off("style.load",this._initialStyleUpdate),this._map=void 0},typeof module!="undefined"&&typeof module.exports!="undefined"?module.exports=MapboxLanguage:window.MapboxLanguage=MapboxLanguage